<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mushtaq Store Tools</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Great+Vibes&family=Allura&family=Pacifico&family=Satisfy&family=Kaushan+Script&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(52, 152, 219, 0.6);
            }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: 1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.15),
                0 0 0 1px rgba(255,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            overflow: hidden;
            position: relative;
            z-index: 2;
            animation: slideInUp 0.8s ease-out;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 300% 100%;
            animation: gradientShift 3s ease infinite;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24, #ff9ff3, #54a0ff);
            background-size: 300% 300%;
            animation: gradientShift 8s ease infinite;
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }
        
        .header h1 {
            font-size: 3.2rem;
            margin-bottom: 15px;
            font-weight: 800;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            animation: bounce 2s ease-in-out infinite;
            background: linear-gradient(45deg, #fff, #f1c40f, #fff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite, bounce 2s ease-in-out infinite;
        }
        
        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: slideInUp 1s ease-out 0.3s both;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: linear-gradient(135deg, #2c3e50, #34495e, #4a6741);
            background-size: 200% 200%;
            animation: gradientShift 10s ease infinite;
            overflow-x: auto;
            border-bottom: 4px solid transparent;
            background-clip: padding-box;
            position: relative;
        }
        
        .nav-tabs::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            background-size: 300% 100%;
            animation: gradientShift 4s ease infinite;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 200px;
            padding: 25px 15px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 600;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            overflow: hidden;
        }
        
        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .nav-tab:hover::before {
            left: 100%;
        }
        
        .nav-tab:hover {
            background: rgba(52, 152, 219, 0.3);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #3498db, #2980b9, #8e44ad);
            background-size: 200% 200%;
            animation: gradientShift 5s ease infinite;
            box-shadow: 
                0 8px 25px rgba(52, 152, 219, 0.4),
                0 0 0 2px rgba(255,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 4px;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #f39c12);
            background-size: 200% 100%;
            animation: gradientShift 2s ease infinite;
            border-radius: 2px 2px 0 0;
        }
        
        .nav-tab-icon {
            font-size: 2.2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .nav-tab:hover .nav-tab-icon {
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
        }
        
        .nav-tab.active .nav-tab-icon {
            animation: pulse 2s ease-in-out infinite;
            transform: scale(1.1);
        }
        
        .nav-tab-text {
            font-size: 0.95rem;
            opacity: 0.95;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .nav-tab:hover .nav-tab-text {
            opacity: 1;
            transform: translateY(-1px);
        }
        
        /* Section Content */
        .section-content {
            display: none;
            padding: 50px 40px;
            min-height: 600px;
            position: relative;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        }
        
        .section-content.active {
            display: block;
            animation: slideInUp 0.6s ease-out;
        }
        
        .section-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 25px;
            border-bottom: 3px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1) border-box;
            position: relative;
            z-index: 1;
        }
        
        .section-header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
            border-radius: 2px;
        }
        
        .section-title {
            font-size: 2.6rem;
            background: linear-gradient(135deg, #2c3e50, #3498db, #9b59b6);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        
        .section-subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            font-weight: 500;
            opacity: 0.9;
            animation: slideInUp 0.8s ease-out 0.2s both;
        }
        
        /* Upload Sections */
        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 35px;
            margin-bottom: 40px;
        }
        
        .upload-box {
            border: 3px dashed #ddd;
            border-radius: 20px;
            padding: 35px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: linear-gradient(135deg, #fafafa, #f0f0f0);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }
        
        .upload-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(52, 152, 219, 0.1) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.6s ease;
        }
        
        .upload-box:hover::before {
            transform: scale(1);
        }
        
        .upload-box:hover {
            border-color: #3498db;
            background: linear-gradient(135deg, #f8f9ff, #e3f2fd);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(52, 152, 219, 0.2),
                0 5px 15px rgba(0,0,0,0.1);
            border-style: solid;
        }
        
        .upload-box.dragover {
            border-color: #3498db;
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            transform: scale(1.05);
            animation: pulse 1s ease-in-out infinite;
        }
        
        .upload-box.uploaded {
            border-color: #27ae60;
            background: linear-gradient(135deg, #f8fff9, #e8f5e8);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.2);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #bdc3c7;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
            position: relative;
            z-index: 1;
        }
        
        .upload-box:hover .upload-icon {
            color: #3498db;
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 6px 12px rgba(52, 152, 219, 0.3));
            animation: bounce 0.6s ease;
        }
        
        .upload-box.dragover .upload-icon {
            color: #2980b9;
            transform: scale(1.3) rotate(-5deg);
            animation: pulse 0.5s ease-in-out infinite;
        }
        
        .upload-box.uploaded .upload-icon {
            color: #27ae60;
            transform: scale(1.1);
            animation: bounce 0.8s ease;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #34495e;
            margin-bottom: 18px;
            font-weight: 700;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .upload-box:hover .upload-text {
            color: #2c3e50;
            transform: translateY(-2px);
        }
        
        .upload-subtext {
            font-size: 1rem;
            color: #7f8c8d;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
            opacity: 0.8;
        }
        
        .upload-box:hover .upload-subtext {
            color: #5d6d7e;
            opacity: 1;
        }
        
        .file-input {
            display: none;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9, #8e44ad);
            background-size: 200% 200%;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 6px;
            display: inline-block;
            font-weight: 600;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
            animation: glow 3s ease-in-out infinite;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 30px rgba(52, 152, 219, 0.4);
            background-position: 100% 0;
        }
        
        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            animation: none;
        }
        
        .btn-small {
            padding: 10px 18px;
            font-size: 0.9rem;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71, #58d68d);
            background-size: 200% 200%;
            animation: glow 3s ease-in-out infinite;
        }
        
        .btn-success:hover {
            box-shadow: 0 15px 30px rgba(39, 174, 96, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22, #ff9f43);
            background-size: 200% 200%;
            animation: glow 3s ease-in-out infinite;
        }
        
        .btn-warning:hover {
            box-shadow: 0 15px 30px rgba(243, 156, 18, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b, #ff6b6b);
            background-size: 200% 200%;
            animation: glow 3s ease-in-out infinite;
        }
        
        .btn-danger:hover {
            box-shadow: 0 15px 30px rgba(231, 76, 60, 0.4);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #9b59b6, #8e44ad, #bb6bd9);
            background-size: 200% 200%;
            animation: glow 3s ease-in-out infinite;
        }
        
        .btn-purple:hover {
            box-shadow: 0 15px 30px rgba(155, 89, 182, 0.4);
        }
        
        /* Preview Cards */
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 35px;
            margin-bottom: 40px;
        }
        
        .preview-card {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1) border-box;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.1),
                0 0 0 1px rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }
        
        .preview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            pointer-events: none;
        }
        
        .preview-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.15),
                0 0 0 1px rgba(255,255,255,0.3);
        }
        
        .preview-card h3 {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            font-size: 1.4rem;
            font-weight: 800;
            position: relative;
            z-index: 1;
        }
        
        .preview-image-container {
            position: relative;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 350px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            display: block;
        }
        
        /* Status Messages */
        .status-message {
            text-align: center;
            padding: 15px 25px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 600;
        }
        
        .status-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #27ae60;
        }
        
        .status-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #e74c3c;
        }
        
        /* Sliders */
        .slider-container {
            margin: 15px 0;
            text-align: left;
        }
        
        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95rem;
            color: #34495e;
            font-weight: 600;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #ecf0f1;
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        /* Edit Tools */
        .edit-tools {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Coming Soon Section */
        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .coming-soon-icon {
            font-size: 4rem;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .coming-soon h3 {
            font-size: 1.8rem;
            color: #495057;
            margin-bottom: 15px;
        }
        
        .coming-soon p {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 25px;
        }
        
        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .feature-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .feature-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                min-width: auto;
                flex-direction: row;
                justify-content: center;
                padding: 15px;
            }
            
            .nav-tab-icon {
                font-size: 1.5rem;
                margin-right: 10px;
            }
            
            .upload-grid, .preview-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .section-content {
                padding: 20px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
        }
        
        /* Crop Overlay Styles */
        .crop-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            cursor: crosshair;
            border-radius: 10px;
        }
        
        .crop-selection {
            position: absolute;
            border: 4px solid #00ff88;
            background: rgba(0,255,136,0.15);
            cursor: move;
            min-width: 30px;
            min-height: 30px;
            box-shadow: 
                0 0 25px rgba(0,255,136,0.8), 
                inset 0 0 25px rgba(0,255,136,0.3),
                0 0 50px rgba(0,255,136,0.4);
            border-radius: 12px;
            animation: cropGlow 2s infinite;
        }
        
        @keyframes cropGlow {
            0%, 100% { 
                box-shadow: 
                    0 0 25px rgba(0,255,136,0.8), 
                    inset 0 0 25px rgba(0,255,136,0.3),
                    0 0 50px rgba(0,255,136,0.4);
            }
            50% { 
                box-shadow: 
                    0 0 35px rgba(0,255,136,1), 
                    inset 0 0 35px rgba(0,255,136,0.5),
                    0 0 70px rgba(0,255,136,0.6);
            }
        }
        
        .crop-controls {
            position: absolute;
            bottom: -70px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            white-space: nowrap;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(0,50,0,0.95));
            padding: 15px 25px;
            border-radius: 30px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(0,255,136,0.3);
        }
        
        .crop-info {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 8px 20px rgba(0,255,136,0.4);
            border: 2px solid rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛠️ Mushtaq Store Tools</h1>
            <p>सभी प्रकार के डॉक्यूमेंट और फोटो टूल्स एक ही जगह</p>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('aadhaar')">
                <div class="nav-tab-icon">📄</div>
                <div class="nav-tab-text">Aadhaar PDF</div>
            </button>
            <button class="nav-tab" onclick="showSection('passport')">
                <div class="nav-tab-icon">📸</div>
                <div class="nav-tab-text">Passport Photo</div>
            </button>
            <button class="nav-tab" onclick="showSection('pancard')">
                <div class="nav-tab-icon">💳</div>
                <div class="nav-tab-text">PAN Card PDF</div>
            </button>
            <button class="nav-tab" onclick="showSection('signature')">
                <div class="nav-tab-icon">✍️</div>
                <div class="nav-tab-text">Signature Maker</div>
            </button>
            <button class="nav-tab" onclick="showSection('compress')">
                <div class="nav-tab-icon">🗜️</div>
                <div class="nav-tab-text">Image Compress</div>
            </button>
            <button class="nav-tab" onclick="showSection('converter')">
                <div class="nav-tab-icon">🔄</div>
                <div class="nav-tab-text">Format Converter</div>
            </button>
            <button class="nav-tab" onclick="showSection('pdfconverter')">
                <div class="nav-tab-icon">📄</div>
                <div class="nav-tab-text">PDF Converter</div>
            </button>
        </div>
        
        <!-- Aadhaar PDF Section -->
        <div id="aadhaar" class="section-content active">
            <div class="section-header">
                <h2 class="section-title">📄 Aadhaar Card PDF Generator</h2>
                <p class="section-subtitle">आधार कार्ड की फोटो अपलोड करें, एडिट करें और PDF बनाएं</p>
            </div>
            
            <div class="upload-grid">
                <div class="upload-box" id="frontUploadBox" onclick="selectFile('front')">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Front Side</div>
                    <div class="upload-subtext">आधार कार्ड का आगे का भाग</div>
                    <input type="file" id="frontFileInput" class="file-input" accept="image/*">
                    <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('front');">
                        📁 Front फोटो चुनें
                    </button>
                </div>
                
                <div class="upload-box" id="backUploadBox" onclick="selectFile('back')">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Back Side</div>
                    <div class="upload-subtext">आधार कार्ड का पीछे का भाग</div>
                    <input type="file" id="backFileInput" class="file-input" accept="image/*">
                    <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('back');">
                        📁 Back फोटो चुनें
                    </button>
                </div>
            </div>
            
            <div class="status-message" id="statusMessage"></div>
            
            <div class="preview-section" id="previewSection" style="display: none;">
                <div class="preview-grid">
                    <div class="preview-card" id="frontPreview" style="display: none;">
                        <h3>Front Side</h3>
                        <div class="preview-image-container">
                            <canvas id="frontCanvas" class="preview-image"></canvas>
                            <div class="crop-overlay" id="frontCropOverlay"></div>
                        </div>
                        
                        <div class="slider-container">
                            <label>Brightness: <span id="frontBrightnessValue">100%</span></label>
                            <input type="range" class="slider" id="frontBrightness" min="0" max="200" value="100">
                        </div>
                        
                        <div class="slider-container">
                            <label>Contrast: <span id="frontContrastValue">100%</span></label>
                            <input type="range" class="slider" id="frontContrast" min="0" max="200" value="100">
                        </div>
                        
                        <div class="edit-tools">
                            <button class="btn btn-small btn-warning" onclick="rotateImage('front')">🔄 Rotate</button>
                            <button class="btn btn-small btn-success" onclick="toggleCrop('front')">✂️ Crop</button>
                            <button class="btn btn-small btn-danger" onclick="enhanceImage('front')">✨ Enhance</button>
                            <button class="btn btn-small" onclick="cleanImage('front')">🧹 Clean</button>
                        </div>
                    </div>
                    
                    <div class="preview-card" id="backPreview" style="display: none;">
                        <h3>Back Side</h3>
                        <div class="preview-image-container">
                            <canvas id="backCanvas" class="preview-image"></canvas>
                            <div class="crop-overlay" id="backCropOverlay"></div>
                        </div>
                        
                        <div class="slider-container">
                            <label>Brightness: <span id="backBrightnessValue">100%</span></label>
                            <input type="range" class="slider" id="backBrightness" min="0" max="200" value="100">
                        </div>
                        
                        <div class="slider-container">
                            <label>Contrast: <span id="backContrastValue">100%</span></label>
                            <input type="range" class="slider" id="backContrast" min="0" max="200" value="100">
                        </div>
                        
                        <div class="edit-tools">
                            <button class="btn btn-small btn-warning" onclick="rotateImage('back')">🔄 Rotate</button>
                            <button class="btn btn-small btn-success" onclick="toggleCrop('back')">✂️ Crop</button>
                            <button class="btn btn-small btn-danger" onclick="enhanceImage('back')">✨ Enhance</button>
                            <button class="btn btn-small" onclick="cleanImage('back')">🧹 Clean</button>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" id="generatePdfBtn" onclick="generatePDF()" disabled>
                        📄 PDF बनाएं
                    </button>
                    <button class="btn" onclick="resetAll()">
                        🔄 Reset All
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Passport Photo Section -->
        <div id="passport" class="section-content">
            <div class="section-header">
                <h2 class="section-title">📸 Passport Size Photo Generator</h2>
                <p class="section-subtitle">किसी भी फोटो को passport size में convert करें</p>
            </div>
            
            <div style="max-width: 600px; margin: 0 auto 30px;">
                <div class="upload-box" id="passportUploadBox" onclick="selectFile('passport')">
                    <div class="upload-icon">📷</div>
                    <div class="upload-text">Upload Photo</div>
                    <div class="upload-subtext">कोई भी फोटो अपलोड करें</div>
                    <input type="file" id="passportFileInput" class="file-input" accept="image/*">
                    <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('passport');">
                        📁 फोटो चुनें
                    </button>
                </div>
            </div>
            
            <div id="passportPreviewSection" style="display: none;">
                <div class="preview-grid">
                    <div class="preview-card">
                        <h3>Original Photo</h3>
                        <div class="preview-image-container">
                            <canvas id="passportOriginalCanvas" class="preview-image"></canvas>
                            <div class="crop-overlay" id="passportCropOverlay"></div>
                        </div>
                        
                        <div class="edit-tools">
                            <button class="btn btn-small btn-warning" onclick="rotatePassportImage()">🔄 Rotate</button>
                            <button class="btn btn-small btn-success" onclick="togglePassportCrop()">✂️ Crop Face</button>
                            <button class="btn btn-small btn-danger" onclick="enhanceImage('passport')">✨ Enhance</button>
                        </div>
                    </div>
                    
                    <div class="preview-card">
                        <h3>Passport Size Preview</h3>
                        <div style="margin-bottom: 20px;">
                            <canvas id="passportFinalCanvas" class="preview-image" style="border: 2px solid #ddd;"></canvas>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Photo Size:</label>
                            <select id="passportSizeSelect" onchange="updatePassportSize()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="passport">Passport (35×45mm)</option>
                                <option value="visa">Visa (25×32mm)</option>
                                <option value="square">Square (50×50mm)</option>
                                <option value="large">Large (40×60mm)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Background:</label>
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <button class="btn btn-small" onclick="changePassportBackground('white')" style="background: white; color: black; border: 1px solid #ddd;">White</button>
                                <button class="btn btn-small" onclick="changePassportBackground('blue')" style="background: #3498db;">Blue</button>
                                <button class="btn btn-small" onclick="changePassportBackground('red')" style="background: #e74c3c;">Red</button>
                                <button class="btn btn-small" onclick="changePassportBackground('transparent')">Transparent</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="downloadPassportPhoto()">
                            💾 Download Photo
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PAN Card PDF Section -->
        <div id="pancard" class="section-content">
            <div class="section-header">
                <h2 class="section-title">💳 PAN Card PDF Generator</h2>
                <p class="section-subtitle">PAN कार्ड की फोटो को PDF में convert करें</p>
            </div>
            
            <div class="coming-soon">
                <div class="coming-soon-icon">🚧</div>
                <h3>Coming Soon!</h3>
                <p>PAN Card PDF Generator जल्द ही आ रहा है</p>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">📷</div>
                        <div class="feature-title">Photo Upload</div>
                        <div class="feature-desc">PAN card की फोटो अपलोड करें</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">✨</div>
                        <div class="feature-title">Auto Enhance</div>
                        <div class="feature-desc">Automatic quality enhancement</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">📄</div>
                        <div class="feature-title">PDF Export</div>
                        <div class="feature-desc">High quality PDF download</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Signature Maker Section -->
        <div id="signature" class="section-content">
            <div class="section-header">
                <h2 class="section-title">✍️ Digital Signature Maker</h2>
                <p class="section-subtitle">अपना डिजिटल signature बनाएं</p>
            </div>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Mode Selection -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="btn btn-success" id="drawModeBtn" onclick="setSignatureMode('draw')">
                        🖊️ Draw Signature
                    </button>
                    <button class="btn" id="textModeBtn" onclick="setSignatureMode('text')">
                        📝 Text Signature
                    </button>
                </div>
                
                <!-- Drawing Section -->
                <div id="drawingSection" style="display: block;">
                    <div class="preview-card">
                        <h3>Draw Your Signature</h3>
                        <div style="margin-bottom: 20px;">
                            <canvas id="signatureCanvas" width="600" height="200" 
                                    style="border: 2px solid #ddd; border-radius: 10px; cursor: crosshair; max-width: 100%; background: white;"></canvas>
                        </div>
                        
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Pen Size:</label>
                                <input type="range" id="penSize" min="1" max="10" value="3" style="width: 100px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Color:</label>
                                <input type="color" id="penColor" value="#000000" style="width: 50px; height: 30px;">
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-warning" onclick="clearSignature()">
                                🗑️ Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Text Section -->
                <div id="textSection" style="display: none;">
                    <div class="preview-card">
                        <h3>Create Text Signature</h3>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Enter Your Name:</label>
                            <input type="text" id="signatureText" placeholder="Your Name" 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Font Style:</label>
                                <select id="fontStyle" onchange="updateTextSignature()" 
                                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="Dancing Script">Dancing Script</option>
                                    <option value="Great Vibes">Great Vibes</option>
                                    <option value="Allura">Allura</option>
                                    <option value="Pacifico">Pacifico</option>
                                    <option value="Satisfy">Satisfy</option>
                                    <option value="Kaushan Script">Kaushan Script</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Size:</label>
                                <input type="range" id="fontSize" min="20" max="80" value="40" onchange="updateTextSignature()"
                                       style="width: 100%;">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 20px; padding: 20px; border: 2px dashed #ddd; border-radius: 10px; background: #f9f9f9;">
                            <div id="textPreview" style="font-family: 'Dancing Script', cursive; font-size: 40px; color: #333;">
                                Your Signature
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="convertTextToCanvas()">
                                ✨ Create Signature
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Download Section -->
                <div class="preview-card" style="margin-top: 30px;">
                    <h3>Download Signature</h3>
                    <div style="text-align: center;">
                        <button class="btn btn-success" onclick="downloadSignature('png')">
                            📥 Download PNG
                        </button>
                        <button class="btn btn-success" onclick="downloadSignature('jpg')">
                            📥 Download JPG
                        </button>
                        <button class="btn btn-success" onclick="downloadSignature('svg')">
                            📥 Download SVG
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Image Compress Section -->
        <div id="compress" class="section-content">
            <div class="section-header">
                <h2 class="section-title">🗜️ Image Compressor</h2>
                <p class="section-subtitle">फोटो का size कम करें quality maintain करते हुए</p>
            </div>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Upload Section -->
                <div class="upload-box" id="compressUploadBox" onclick="selectFile('compress')">
                    <div class="upload-icon">🗜️</div>
                    <div class="upload-text">Upload Images to Compress</div>
                    <div class="upload-subtext">Multiple images select कर सकते हैं</div>
                    <input type="file" id="compressFileInput" class="file-input" accept="image/*" multiple>
                    <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('compress');">
                        📁 Images चुनें
                    </button>
                </div>
                
                <!-- Compression Settings -->
                <div id="compressionSettings" style="display: none; margin-top: 30px;">
                    <div class="preview-card">
                        <h3>Compression Settings</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                                    Quality: <span id="qualityValue">80%</span>
                                </label>
                                <input type="range" id="qualitySlider" min="10" max="100" value="80" 
                                       onchange="updateQualityValue()" style="width: 100%;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Max Width (px):</label>
                                <input type="number" id="maxWidth" value="1920" min="100" max="4000" 
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Output Format:</label>
                                <select id="outputFormat" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="jpeg">JPEG</option>
                                    <option value="png">PNG</option>
                                    <option value="webp">WebP</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="compressAllImages()">
                                🗜️ Compress All Images
                            </button>
                            <button class="btn btn-warning" onclick="clearCompressedImages()">
                                🗑️ Clear All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="compressionResults" style="display: none; margin-top: 30px;">
                    <div class="section-header">
                        <h3>Compressed Images</h3>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-success" onclick="downloadAllCompressed()">
                                📥 Download All
                            </button>
                        </div>
                    </div>
                    
                    <div id="compressedImagesList" class="preview-grid">
                        <!-- Compressed images will appear here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Format Converter Section -->
        <div id="converter" class="section-content">
            <div class="section-header">
                <h2 class="section-title">🔄 Format Converter</h2>
                <p class="section-subtitle">Images को अलग-अलग formats में convert करें</p>
            </div>
            
            <div style="max-width: 800px; margin: 0 auto;">
                <!-- Upload Section -->
                <div class="upload-box" id="converterUploadBox" onclick="selectFile('converter')">
                    <div class="upload-icon">🔄</div>
                    <div class="upload-text">Upload Images to Convert</div>
                    <div class="upload-subtext">Multiple images select कर सकते हैं</div>
                    <input type="file" id="converterFileInput" class="file-input" accept="image/*" multiple>
                    <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('converter');">
                        📁 Images चुनें
                    </button>
                </div>
                
                <!-- Preview Section -->
                <div id="converterPreviewSection" style="display: none; margin-top: 30px;">
                    <div class="section-header">
                        <h3>Uploaded Images Preview</h3>
                    </div>
                    <div id="converterPreviewList" class="preview-grid">
                        <!-- Preview images will appear here -->
                    </div>
                </div>
                
                <!-- Conversion Settings -->
                <div id="conversionSettings" style="display: none; margin-top: 30px;">
                    <div class="preview-card">
                        <h3>Conversion Settings</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Convert To:</label>
                                <select id="convertFormat" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="jpeg">JPEG</option>
                                    <option value="png">PNG</option>
                                    <option value="webp">WebP</option>
                                    <option value="bmp">BMP</option>
                                    <option value="pdf">PDF</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                                    Quality: <span id="convertQualityValue">90%</span>
                                </label>
                                <input type="range" id="convertQualitySlider" min="10" max="100" value="90" 
                                       onchange="updateConvertQualityValue()" style="width: 100%;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Width (px):</label>
                                <input type="number" id="convertWidth" placeholder="Auto" min="50" max="4000" 
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Height (px):</label>
                                <input type="number" id="convertHeight" placeholder="Auto" min="50" max="4000" 
                                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="btn btn-success" onclick="convertAllImages()">
                                🔄 Convert All Images
                            </button>
                            <button class="btn btn-warning" onclick="clearConvertedImages()">
                                🗑️ Clear All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="conversionResults" style="display: none; margin-top: 30px;">
                    <div class="section-header">
                        <h3>Converted Images</h3>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-success" onclick="downloadAllConverted()">
                                📥 Download All
                            </button>
                        </div>
                    </div>
                    
                    <div id="convertedImagesList" class="preview-grid">
                        <!-- Converted images will appear here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PDF Converter Section -->
        <div id="pdfconverter" class="section-content">
            <div class="section-header">
                <h2 class="section-title">📄 PDF Converter</h2>
                <p class="section-subtitle">PDF को images में convert करें या images को PDF में</p>
            </div>
            
            <div style="max-width: 1000px; margin: 0 auto;">
                <!-- Mode Selection -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="btn btn-success" id="imageToPdfBtn" onclick="setPdfMode('imageToPdf')">
                        📄 Images to PDF
                    </button>
                    <button class="btn" id="pdfToImageBtn" onclick="setPdfMode('pdfToImage')">
                        🖼️ PDF to Images
                    </button>
                </div>
                
                <!-- Images to PDF Section -->
                <div id="imageToPdfSection" style="display: block;">
                    <div class="upload-box" id="pdfImagesUploadBox" onclick="selectFile('pdfImages')">
                        <div class="upload-icon">📄</div>
                        <div class="upload-text">Upload Images for PDF</div>
                        <div class="upload-subtext">Multiple images select कर सकते हैं</div>
                        <input type="file" id="pdfImagesFileInput" class="file-input" accept="image/*" multiple>
                        <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('pdfImages');">
                            📁 Images चुनें
                        </button>
                    </div>
                    
                    <!-- Images Preview and Edit -->
                    <div id="pdfImagesPreviewSection" style="display: none; margin-top: 30px;">
                        <div class="section-header">
                            <h3>Images Preview & Edit</h3>
                        </div>
                        <div id="pdfImagesPreviewList" class="preview-grid">
                            <!-- Preview images will appear here -->
                        </div>
                        
                        <!-- PDF Settings -->
                        <div class="preview-card" style="margin-top: 30px;">
                            <h3>PDF Settings</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Page Size:</label>
                                    <select id="pdfPageSize" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="a4">A4</option>
                                        <option value="a3">A3</option>
                                        <option value="letter">Letter</option>
                                        <option value="legal">Legal</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Orientation:</label>
                                    <select id="pdfOrientation" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="portrait">Portrait</option>
                                        <option value="landscape">Landscape</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                                        Quality: <span id="pdfQualityValue">90%</span>
                                    </label>
                                    <input type="range" id="pdfQualitySlider" min="10" max="100" value="90" 
                                           onchange="updatePdfQualityValue()" style="width: 100%;">
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Images per Page:</label>
                                    <select id="imagesPerPage" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="1">1 Image per Page</option>
                                        <option value="2">2 Images per Page</option>
                                        <option value="4">4 Images per Page</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <button class="btn btn-success" onclick="createPdfFromImages()">
                                    📄 Create PDF
                                </button>
                                <button class="btn btn-warning" onclick="clearPdfImages()">
                                    🗑️ Clear All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- PDF to Images Section -->
                <div id="pdfToImageSection" style="display: none;">
                    <div class="upload-box" id="pdfFileUploadBox" onclick="selectFile('pdfFile')">
                        <div class="upload-icon">📄</div>
                        <div class="upload-text">Upload PDF File</div>
                        <div class="upload-subtext">PDF file select करें</div>
                        <input type="file" id="pdfFileInput" class="file-input" accept=".pdf">
                        <button class="btn" type="button" onclick="event.stopPropagation(); selectFile('pdfFile');">
                            📁 PDF चुनें
                        </button>
                    </div>
                    
                    <!-- PDF Preview and Settings -->
                    <div id="pdfPreviewSection" style="display: none; margin-top: 30px;">
                        <div class="preview-card">
                            <h3>PDF to Images Settings</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Output Format:</label>
                                    <select id="pdfToImageFormat" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="png">PNG</option>
                                        <option value="jpeg">JPEG</option>
                                        <option value="webp">WebP</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                                        Quality: <span id="pdfToImageQualityValue">90%</span>
                                    </label>
                                    <input type="range" id="pdfToImageQualitySlider" min="10" max="100" value="90" 
                                           onchange="updatePdfToImageQualityValue()" style="width: 100%;">
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Resolution (DPI):</label>
                                    <select id="pdfResolution" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="72">72 DPI (Web)</option>
                                        <option value="150" selected>150 DPI (Standard)</option>
                                        <option value="300">300 DPI (High Quality)</option>
                                        <option value="600">600 DPI (Print Quality)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Page Range:</label>
                                    <input type="text" id="pageRange" placeholder="e.g., 1-5 or 1,3,5" 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <button class="btn btn-success" onclick="convertPdfToImages()">
                                    🖼️ Convert to Images
                                </button>
                                <button class="btn btn-warning" onclick="clearPdfFile()">
                                    🗑️ Clear
                                </button>
                            </div>
                        </div>
                        
                        <!-- PDF Pages Preview -->
                        <div id="pdfPagesPreview" style="margin-top: 30px; display: none;">
                            <div class="section-header">
                                <h3>PDF Pages</h3>
                            </div>
                            <div id="pdfPagesList" class="preview-grid">
                                <!-- PDF pages will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="pdfConversionResults" style="display: none; margin-top: 30px;">
                    <div class="section-header">
                        <h3>Conversion Results</h3>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn btn-success" onclick="downloadAllPdfResults()">
                                📥 Download All
                            </button>
                        </div>
                    </div>
                    
                    <div id="pdfResultsList" class="preview-grid">
                        <!-- Results will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let images = { front: null, back: null };
        let canvases = { front: null, back: null };
        let contexts = { front: null, back: null };
        let rotations = { front: 0, back: 0 };
        let cropMode = { front: false, back: false };
        let cropData = {
            front: { startX: 0, startY: 0, endX: 0, endY: 0, isSelecting: false },
            back: { startX: 0, startY: 0, endX: 0, endY: 0, isSelecting: false }
        };
        
        // Passport photo variables
        let passportImage = null;
        let passportOriginalCanvas = null;
        let passportFinalCanvas = null;
        let passportOriginalCtx = null;
        let passportFinalCtx = null;
        let passportRotation = 0;
        let passportCropMode = false;
        let passportCropData = { startX: 0, startY: 0, endX: 0, endY: 0, isSelecting: false };
        let passportBackground = 'white';
        
        // Signature maker variables
        let signatureCanvas = null;
        let signatureCtx = null;
        let isDrawing = false;
        let signatureMode = 'draw';
        
        // Compression variables
        let compressImages = [];
        let compressedResults = [];
        
        // Converter variables
        let converterImages = [];
        let convertedResults = [];
        
        // PDF Converter variables
        let pdfConverterMode = 'imageToPdf';
        let pdfImages = [];
        let pdfFile = null;
        let pdfResults = [];
        let pdfImageEditData = {};
        
        // Passport size configurations
        const passportSizes = {
            passport: { width: 413, height: 531 },
            visa: { width: 295, height: 378 },
            square: { width: 590, height: 590 },
            large: { width: 472, height: 708 }
        };
        
        // Navigation Functions
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section-content');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.classList.add('active');
            }
            
            // Add active class to clicked tab
            event.target.closest('.nav-tab').classList.add('active');
            
            console.log('Switched to section:', sectionId);
        }
        
        // Initialize everything when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            initializeApp();
            addStaggeredAnimations();
        });
        
        function addStaggeredAnimations() {
            // Add staggered animations to upload boxes
            const uploadBoxes = document.querySelectorAll('.upload-box');
            uploadBoxes.forEach((box, index) => {
                box.style.animationDelay = `${index * 0.1}s`;
            });
            
            // Add staggered animations to nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach((tab, index) => {
                tab.style.animation = `slideInUp 0.6s ease-out ${index * 0.1}s both`;
            });
            
            // Add staggered animations to preview cards
            const previewCards = document.querySelectorAll('.preview-card');
            previewCards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.15}s`;
            });
        }
        
        function initializeApp() {
            try {
                setupFileInputs();
                setupSliders();
                initializeCanvases();
                setupPassportPhoto();
                setupSignature();
                setupCompression();
                setupConverter();
                setupPdfConverter();
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }
        
        // File selection functions
        function selectFile(type) {
            console.log('Selecting file for:', type);
            let inputId = type + 'FileInput';
            
            // Handle special cases
            if (type === 'pdfFile') {
                inputId = 'pdfFileInput';
            } else if (type === 'pdfImages') {
                inputId = 'pdfImagesFileInput';
            }
            
            const fileInput = document.getElementById(inputId);
            if (fileInput) {
                console.log('Clicking file input:', inputId);
                fileInput.click();
            } else {
                console.error('File input not found:', inputId);
                showStatus('File input not found! Please refresh the page.', 'error');
            }
        }
        
        function setupFileInputs() {
            console.log('Setting up file inputs...');
            
            // Front file input
            const frontInput = document.getElementById('frontFileInput');
            if (frontInput) {
                frontInput.addEventListener('change', (e) => {
                    console.log('Front file selected');
                    handleFileUpload(e, 'front');
                });
            }
            
            // Back file input
            const backInput = document.getElementById('backFileInput');
            if (backInput) {
                backInput.addEventListener('change', (e) => {
                    console.log('Back file selected');
                    handleFileUpload(e, 'back');
                });
            }
            
            // Passport file input
            const passportInput = document.getElementById('passportFileInput');
            if (passportInput) {
                passportInput.addEventListener('change', (e) => {
                    console.log('Passport file selected');
                    handlePassportUpload(e);
                });
            }
            
            // Setup drag and drop
            setupDragDrop('frontUploadBox', 'front');
            setupDragDrop('backUploadBox', 'back');
            setupDragDrop('passportUploadBox', 'passport');
        }
        
        function setupDragDrop(boxId, side) {
            const box = document.getElementById(boxId);
            if (!box) return;
            
            box.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                box.classList.add('dragover');
            });
            
            box.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                box.classList.remove('dragover');
            });
            
            box.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                box.classList.remove('dragover');
                
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0 && files[0].type.startsWith('image/')) {
                    if (side === 'passport') {
                        handlePassportUpload({ target: { files: files } });
                    } else if (side === 'compress') {
                        handleCompressUpload({ target: { files: files } });
                    } else if (side === 'converter') {
                        handleConverterUpload({ target: { files: files } });
                    } else if (side === 'pdfImages') {
                        handlePdfImagesUpload({ target: { files: files } });
                    } else if (side === 'pdfFile') {
                        // Check if it's a PDF file with comprehensive validation
                        const pdfFiles = files.filter(file => {
                            const fileName = file.name.toLowerCase();
                            const fileExtension = fileName.split('.').pop();
                            const validExtensions = ['pdf'];
                            const validMimeTypes = ['application/pdf', 'application/x-pdf', 'application/acrobat', 'applications/vnd.pdf', 'text/pdf', 'text/x-pdf'];
                            
                            const hasValidExtension = validExtensions.includes(fileExtension);
                            const hasValidMimeType = validMimeTypes.includes(file.type) || file.type === '';
                            
                            return hasValidExtension || hasValidMimeType;
                        });
                        
                        if (pdfFiles.length > 0) {
                            console.log('PDF file dropped:', pdfFiles[0].name);
                            handlePdfFileUpload({ target: { files: [pdfFiles[0]] } });
                        } else {
                            const fileTypes = files.map(f => `${f.name} (${f.type || 'unknown type'})`).join(', ');
                            showStatus(`कृपया केवल PDF file drag करें! Dropped files: ${fileTypes}`, 'error');
                        }
                    } else {
                        handleFileUpload({ target: { files: files } }, side);
                    }
                }
            });
        }
        
        function setupSliders() {
            console.log('Setting up sliders...');
            
            ['front', 'back'].forEach(side => {
                const brightnessSlider = document.getElementById(`${side}Brightness`);
                const contrastSlider = document.getElementById(`${side}Contrast`);
                
                if (brightnessSlider) {
                    brightnessSlider.addEventListener('input', (e) => {
                        document.getElementById(`${side}BrightnessValue`).textContent = e.target.value + '%';
                        applyFilters(side);
                    });
                }
                
                if (contrastSlider) {
                    contrastSlider.addEventListener('input', (e) => {
                        document.getElementById(`${side}ContrastValue`).textContent = e.target.value + '%';
                        applyFilters(side);
                    });
                }
            });
        }
        
        function initializeCanvases() {
            console.log('Initializing canvases...');
            
            canvases.front = document.getElementById('frontCanvas');
            canvases.back = document.getElementById('backCanvas');
            
            if (canvases.front) contexts.front = canvases.front.getContext('2d');
            if (canvases.back) contexts.back = canvases.back.getContext('2d');
        }
        
        function handleFileUpload(event, side) {
            console.log('Handling file upload for:', side);
            
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('image/')) {
                showStatus('कृपया केवल इमेज फाइल अपलोड करें!', 'error');
                return;
            }
            
            showStatus(`${side === 'front' ? 'Front' : 'Back'} फोटो अपलोड हो रही है...`, 'success');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    console.log(`${side} image loaded successfully`);
                    images[side] = img;
                    drawImageOnCanvas(side);
                    showPreview(side);
                    updateUploadBox(side, true);
                    checkBothUploaded();
                    showStatus(`${side === 'front' ? 'Front' : 'Back'} फोटो सफलतापूर्वक अपलोड हो गई!`, 'success');
                };
                img.onerror = () => {
                    console.error(`Error loading ${side} image`);
                    showStatus('फोटो लोड करने में समस्या हुई!', 'error');
                };
                img.src = e.target.result;
            };
            reader.onerror = () => {
                console.error(`Error reading ${side} file`);
                showStatus('फाइल पढ़ने में समस्या हुई!', 'error');
            };
            reader.readAsDataURL(file);
        }
        
        function drawImageOnCanvas(side) {
            console.log('Drawing image on canvas for:', side);
            
            const canvas = canvases[side];
            const ctx = contexts[side];
            const img = images[side];
            
            if (!canvas || !ctx || !img) {
                console.error('Missing canvas, context, or image for:', side);
                return;
            }
            
            const maxWidth = 800;
            const maxHeight = 600;
            let { width, height } = calculateDimensions(img.width, img.height, maxWidth, maxHeight);
            
            canvas.width = width;
            canvas.height = height;
            canvas.style.maxWidth = '100%';
            canvas.style.height = 'auto';
            canvas.style.width = Math.min(width / 2, 400) + 'px';
            
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.clearRect(0, 0, width, height);
            ctx.filter = 'none';
            
            ctx.save();
            ctx.translate(width / 2, height / 2);
            ctx.rotate((rotations[side] * Math.PI) / 180);
            ctx.drawImage(img, -width / 2, -height / 2, width, height);
            ctx.restore();
            
            setTimeout(() => applyFilters(side), 10);
        }
        
        function calculateDimensions(imgWidth, imgHeight, maxWidth, maxHeight) {
            let width = imgWidth;
            let height = imgHeight;
            
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }
            
            return { width: Math.round(width), height: Math.round(height) };
        }
        
        function applyFilters(side) {
            const canvas = canvases[side];
            const ctx = contexts[side];
            const img = images[side];
            
            if (!canvas || !ctx || !img) return;
            
            const brightness = document.getElementById(`${side}Brightness`).value;
            const contrast = document.getElementById(`${side}Contrast`).value;
            
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.filter = `brightness(${brightness}%) contrast(${contrast}%)`;
            
            ctx.save();
            ctx.translate(width / 2, height / 2);
            ctx.rotate((rotations[side] * Math.PI) / 180);
            ctx.drawImage(img, -width / 2, -height / 2, width, height);
            ctx.restore();
        }
        
        // Button functions
        function rotateImage(side) {
            console.log('Rotating image:', side);
            rotations[side] = (rotations[side] + 90) % 360;
            drawImageOnCanvas(side);
            showStatus(`${side === 'front' ? 'Front' : 'Back'} image rotated!`, 'success');
        }
        
        function toggleCrop(side) {
            console.log('Toggling crop for:', side);
            cropMode[side] = !cropMode[side];
            const overlay = document.getElementById(`${side}CropOverlay`);
            
            if (!overlay) {
                console.error('Crop overlay not found for:', side);
                return;
            }
            
            if (cropMode[side]) {
                overlay.style.display = 'block';
                setupCropEvents(side);
                showStatus('Crop mode ON! Area select करने के लिए drag करें।', 'success');
            } else {
                overlay.style.display = 'none';
                removeCropEvents(side);
                clearCropSelection(side);
                showStatus('Crop mode OFF।', 'success');
            }
        }
        
        function setupCropEvents(side) {
            const overlay = document.getElementById(`${side}CropOverlay`);
            if (!overlay) return;
            
            overlay._mousedownHandler = (e) => startCrop(e, side);
            overlay._mousemoveHandler = (e) => updateCrop(e, side);
            overlay._mouseupHandler = (e) => endCrop(e, side);
            overlay._mouseleaveHandler = (e) => endCrop(e, side);
            
            overlay.addEventListener('mousedown', overlay._mousedownHandler);
            overlay.addEventListener('mousemove', overlay._mousemoveHandler);
            overlay.addEventListener('mouseup', overlay._mouseupHandler);
            overlay.addEventListener('mouseleave', overlay._mouseleaveHandler);
        }
        
        function removeCropEvents(side) {
            const overlay = document.getElementById(`${side}CropOverlay`);
            if (!overlay) return;
            
            if (overlay._mousedownHandler) {
                overlay.removeEventListener('mousedown', overlay._mousedownHandler);
                overlay.removeEventListener('mousemove', overlay._mousemoveHandler);
                overlay.removeEventListener('mouseup', overlay._mouseupHandler);
                overlay.removeEventListener('mouseleave', overlay._mouseleaveHandler);
            }
        }
        
        function clearCropSelection(side) {
            const overlay = document.getElementById(`${side}CropOverlay`);
            if (!overlay) return;
            
            const selection = overlay.querySelector('.crop-selection');
            if (selection) selection.remove();
        }
        
        function startCrop(e, side) {
            const rect = e.target.getBoundingClientRect();
            cropData[side].startX = e.clientX - rect.left;
            cropData[side].startY = e.clientY - rect.top;
            cropData[side].isSelecting = true;
            clearCropSelection(side);
        }
        
        function updateCrop(e, side) {
            if (!cropData[side].isSelecting) return;
            
            const rect = e.target.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            const overlay = document.getElementById(`${side}CropOverlay`);
            let selection = overlay.querySelector('.crop-selection');
            
            if (!selection) {
                selection = document.createElement('div');
                selection.className = 'crop-selection';
                overlay.appendChild(selection);
            }
            
            const left = Math.min(cropData[side].startX, currentX);
            const top = Math.min(cropData[side].startY, currentY);
            const width = Math.abs(currentX - cropData[side].startX);
            const height = Math.abs(currentY - cropData[side].startY);
            
            selection.style.left = left + 'px';
            selection.style.top = top + 'px';
            selection.style.width = width + 'px';
            selection.style.height = height + 'px';
            
            let info = selection.querySelector('.crop-info');
            if (!info) {
                info = document.createElement('div');
                info.className = 'crop-info';
                selection.appendChild(info);
            }
            info.innerHTML = `📐 ${Math.round(width)} × ${Math.round(height)} px`;
        }
        
        function endCrop(e, side) {
            if (!cropData[side].isSelecting) return;
            
            const rect = e.target.getBoundingClientRect();
            cropData[side].endX = e.clientX - rect.left;
            cropData[side].endY = e.clientY - rect.top;
            cropData[side].isSelecting = false;
            
            const overlay = document.getElementById(`${side}CropOverlay`);
            const selection = overlay.querySelector('.crop-selection');
            if (selection && parseInt(selection.style.width) > 20 && parseInt(selection.style.height) > 20) {
                const controls = document.createElement('div');
                controls.className = 'crop-controls';
                controls.innerHTML = `
                    <button class="btn btn-small btn-success" onclick="applyCrop('${side}')">✂️ Apply Crop</button>
                    <button class="btn btn-small" onclick="clearCropSelection('${side}')">❌ Cancel</button>
                `;
                selection.appendChild(controls);
            }
        }
        
        function applyCrop(side) {
            console.log('Applying crop for:', side);
            
            const canvas = canvases[side];
            const ctx = contexts[side];
            const overlay = document.getElementById(`${side}CropOverlay`);
            const selection = overlay.querySelector('.crop-selection');
            
            if (!selection) {
                showStatus('कोई crop area select नहीं किया गया!', 'error');
                return;
            }
            
            try {
                const selectionRect = {
                    left: parseInt(selection.style.left) || 0,
                    top: parseInt(selection.style.top) || 0,
                    width: parseInt(selection.style.width) || 0,
                    height: parseInt(selection.style.height) || 0
                };
                
                const overlayRect = overlay.getBoundingClientRect();
                const scaleX = canvas.width / overlayRect.width;
                const scaleY = canvas.height / overlayRect.height;
                
                const cropX = Math.round(selectionRect.left * scaleX);
                const cropY = Math.round(selectionRect.top * scaleY);
                const cropWidth = Math.round(selectionRect.width * scaleX);
                const cropHeight = Math.round(selectionRect.height * scaleY);
                
                if (cropWidth < 10 || cropHeight < 10) {
                    showStatus('Crop area बहुत छोटा है!', 'error');
                    return;
                }
                
                const currentDataURL = canvas.toDataURL('image/png', 1.0);
                const tempImg = new Image();
                
                tempImg.onload = () => {
                    canvas.width = cropWidth;
                    canvas.height = cropHeight;
                    
                    ctx.clearRect(0, 0, cropWidth, cropHeight);
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(tempImg, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                    
                    const displayWidth = Math.min(cropWidth / 2, 400);
                    canvas.style.width = displayWidth + 'px';
                    canvas.style.height = 'auto';
                    
                    const newImg = new Image();
                    newImg.onload = () => {
                        images[side] = newImg;
                    };
                    newImg.src = canvas.toDataURL('image/png', 1.0);
                    
                    toggleCrop(side);
                    showStatus(`${side === 'front' ? 'Front' : 'Back'} image successfully cropped! ✂️`, 'success');
                };
                
                tempImg.src = currentDataURL;
                
            } catch (error) {
                console.error('Crop error:', error);
                showStatus('Cropping में error आया! फिर से try करें।', 'error');
            }
        }
        
        function enhanceImage(side) {
            console.log('Enhancing image:', side);
            
            if (side === 'passport') {
                if (!passportImage) return;
                
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = passportImage.width;
                tempCanvas.height = passportImage.height;
                
                tempCtx.filter = 'brightness(110%) contrast(120%) saturate(110%)';
                tempCtx.drawImage(passportImage, 0, 0);
                
                const enhancedImg = new Image();
                enhancedImg.onload = () => {
                    passportImage = enhancedImg;
                    drawPassportImage();
                    showStatus('Passport photo enhanced!', 'success');
                };
                enhancedImg.src = tempCanvas.toDataURL('image/png', 1.0);
            } else {
                document.getElementById(`${side}Brightness`).value = 110;
                document.getElementById(`${side}Contrast`).value = 120;
                
                document.getElementById(`${side}BrightnessValue`).textContent = '110%';
                document.getElementById(`${side}ContrastValue`).textContent = '120%';
                
                applyFilters(side);
                showStatus(`${side === 'front' ? 'Front' : 'Back'} image enhanced!`, 'success');
            }
        }
        
        function cleanImage(side) {
            console.log('Cleaning image:', side);
            
            rotations[side] = 0;
            document.getElementById(`${side}Brightness`).value = 100;
            document.getElementById(`${side}Contrast`).value = 100;
            
            document.getElementById(`${side}BrightnessValue`).textContent = '100%';
            document.getElementById(`${side}ContrastValue`).textContent = '100%';
            
            drawImageOnCanvas(side);
            showStatus(`${side === 'front' ? 'Front' : 'Back'} image cleaned!`, 'success');
        }
        
        function showPreview(side) {
            const preview = document.getElementById(`${side}Preview`);
            const previewSection = document.getElementById('previewSection');
            
            if (preview) preview.style.display = 'block';
            if (previewSection) previewSection.style.display = 'block';
        }
        
        function updateUploadBox(side, uploaded) {
            const box = document.getElementById(`${side}UploadBox`);
            if (!box) return;
            
            if (uploaded) {
                box.classList.add('uploaded');
                const icon = box.querySelector('.upload-icon');
                const text = box.querySelector('.upload-text');
                
                if (icon) icon.textContent = '✅';
                if (text) text.innerHTML = `${side === 'front' ? 'Front' : 'Back'} Side`;
                
                const subtext = box.querySelector('.upload-subtext');
                if (subtext) subtext.innerHTML = 'अपलोड हो गया!';
            }
        }
        
        function checkBothUploaded() {
            const generateBtn = document.getElementById('generatePdfBtn');
            if (generateBtn && images.front && images.back) {
                generateBtn.disabled = false;
                showStatus('दोनों फोटो अपलोड हो गईं! अब आप PDF बना सकते हैं।', 'success');
            }
        }
        
        function generatePDF() {
            console.log('Generating PDF...');
            
            if (!images.front || !images.back) {
                showStatus('कृपया दोनों फोटो अपलोड करें!', 'error');
                return;
            }
            
            showStatus('PDF बनाई जा रही है...', 'success');
            const generateBtn = document.getElementById('generatePdfBtn');
            if (generateBtn) generateBtn.disabled = true;
            
            try {
                const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                function calculatePdfDimensions(canvas, maxWidth) {
                    const aspectRatio = canvas.width / canvas.height;
                    let width = maxWidth;
                    let height = width / aspectRatio;
                    
                    const maxHeight = pageHeight * 0.35;
                    if (height > maxHeight) {
                        height = maxHeight;
                        width = height * aspectRatio;
                    }
                    
                    return { width, height };
                }
                
                const maxCardWidth = pageWidth * 0.6;
                
                // Add front image
                const frontDimensions = calculatePdfDimensions(canvases.front, maxCardWidth);
                const frontX = (pageWidth - frontDimensions.width) / 2;
                const frontY = 40;
                
                const frontDataUrl = canvases.front.toDataURL('image/jpeg', 0.9);
                pdf.addImage(frontDataUrl, 'JPEG', frontX, frontY, frontDimensions.width, frontDimensions.height);
                
                // Add back image
                const backDimensions = calculatePdfDimensions(canvases.back, maxCardWidth);
                const backX = (pageWidth - backDimensions.width) / 2;
                const backY = frontY + frontDimensions.height + 30;
                
                const backDataUrl = canvases.back.toDataURL('image/jpeg', 0.9);
                pdf.addImage(backDataUrl, 'JPEG', backX, backY, backDimensions.width, backDimensions.height);
                
                // Save PDF
                const fileName = `Aadhaar_Card_${Date.now()}.pdf`;
                pdf.save(fileName);
                
                showStatus('PDF सफलतापूर्वक डाउनलोड हो गई! ✅', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showStatus('PDF बनाने में समस्या हुई। कृपया फिर से कोशिश करें।', 'error');
            }
            
            if (generateBtn) generateBtn.disabled = false;
        }
        
        function resetAll() {
            console.log('Resetting all...');
            
            images = { front: null, back: null };
            rotations = { front: 0, back: 0 };
            cropMode = { front: false, back: false };
            cropData = {
                front: { startX: 0, startY: 0, endX: 0, endY: 0, isSelecting: false },
                back: { startX: 0, startY: 0, endX: 0, endY: 0, isSelecting: false }
            };
            
            ['front', 'back'].forEach(side => {
                const box = document.getElementById(`${side}UploadBox`);
                if (box) {
                    box.classList.remove('uploaded');
                    const icon = box.querySelector('.upload-icon');
                    const text = box.querySelector('.upload-text');
                    const subtext = box.querySelector('.upload-subtext');
                    
                    if (icon) icon.textContent = '📄';
                    if (text) text.innerHTML = `${side === 'front' ? 'Front' : 'Back'} Side`;
                    if (subtext) subtext.innerHTML = `आधार कार्ड का ${side === 'front' ? 'आगे' : 'पीछे'} का भाग`;
                }
                
                // Reset sliders
                const brightnessSlider = document.getElementById(`${side}Brightness`);
                const contrastSlider = document.getElementById(`${side}Contrast`);
                
                if (brightnessSlider) {
                    brightnessSlider.value = 100;
                    document.getElementById(`${side}BrightnessValue`).textContent = '100%';
                }
                
                if (contrastSlider) {
                    contrastSlider.value = 100;
                    document.getElementById(`${side}ContrastValue`).textContent = '100%';
                }
                
                // Hide previews
                const preview = document.getElementById(`${side}Preview`);
                if (preview) preview.style.display = 'none';
                
                // Clear file inputs
                const fileInput = document.getElementById(`${side}FileInput`);
                if (fileInput) fileInput.value = '';
                
                // Clear crop overlays
                clearCropSelection(side);
                const overlay = document.getElementById(`${side}CropOverlay`);
                if (overlay) overlay.style.display = 'none';
            });
            
            const previewSection = document.getElementById('previewSection');
            if (previewSection) previewSection.style.display = 'none';
            
            const generateBtn = document.getElementById('generatePdfBtn');
            if (generateBtn) generateBtn.disabled = true;
            
            hideStatus();
            showStatus('सब कुछ reset हो गया!', 'success');
        }
        
        function showStatus(message, type) {
            const statusMessage = document.getElementById('statusMessage');
            if (statusMessage) {
                statusMessage.textContent = message;
                statusMessage.className = `status-message status-${type}`;
                statusMessage.style.display = 'block';
                
                // Auto hide after 5 seconds
                setTimeout(() => {
                    hideStatus();
                }, 5000);
            }
        }
        
        function hideStatus() {
            const statusMessage = document.getElementById('statusMessage');
            if (statusMessage) {
                statusMessage.style.display = 'none';
            }
        }
        
        // Passport Photo Functions
        function setupPassportPhoto() {
            console.log('Setting up passport photo...');
            
            passportOriginalCanvas = document.getElementById('passportOriginalCanvas');
            passportFinalCanvas = document.getElementById('passportFinalCanvas');
            
            if (passportOriginalCanvas) passportOriginalCtx = passportOriginalCanvas.getContext('2d');
            if (passportFinalCanvas) passportFinalCtx = passportFinalCanvas.getContext('2d');
        }
        
        function handlePassportUpload(event) {
            console.log('Handling passport upload...');
            
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('image/')) {
                showStatus('कृपया केवल इमेज फाइल अपलोड करें!', 'error');
                return;
            }
            
            showStatus('Passport फोटो अपलोड हो रही है...', 'success');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    console.log('Passport image loaded successfully');
                    passportImage = img;
                    passportRotation = 0;
                    drawPassportOriginal();
                    drawPassportFinal();
                    showPassportPreview();
                    updatePassportUploadBox(true);
                    showStatus('Passport फोटो सफलतापूर्वक अपलोड हो गई!', 'success');
                };
                img.onerror = () => {
                    console.error('Error loading passport image');
                    showStatus('फोटो लोड करने में समस्या हुई!', 'error');
                };
                img.src = e.target.result;
            };
            reader.onerror = () => {
                console.error('Error reading passport file');
                showStatus('फाइल पढ़ने में समस्या हुई!', 'error');
            };
            reader.readAsDataURL(file);
        }
        
        function drawPassportOriginal() {
            if (!passportImage || !passportOriginalCanvas || !passportOriginalCtx) return;
            
            const maxWidth = 400;
            const maxHeight = 400;
            let { width, height } = calculateDimensions(passportImage.width, passportImage.height, maxWidth, maxHeight);
            
            passportOriginalCanvas.width = width;
            passportOriginalCanvas.height = height;
            passportOriginalCanvas.style.width = Math.min(width, 300) + 'px';
            passportOriginalCanvas.style.height = 'auto';
            
            passportOriginalCtx.clearRect(0, 0, width, height);
            passportOriginalCtx.imageSmoothingEnabled = true;
            passportOriginalCtx.imageSmoothingQuality = 'high';
            
            passportOriginalCtx.save();
            passportOriginalCtx.translate(width / 2, height / 2);
            passportOriginalCtx.rotate((passportRotation * Math.PI) / 180);
            passportOriginalCtx.drawImage(passportImage, -width / 2, -height / 2, width, height);
            passportOriginalCtx.restore();
        }
        
        function drawPassportFinal() {
            if (!passportImage || !passportFinalCanvas || !passportFinalCtx) return;
            
            const selectedSize = document.getElementById('passportSizeSelect').value;
            const size = passportSizes[selectedSize];
            
            passportFinalCanvas.width = size.width;
            passportFinalCanvas.height = size.height;
            
            const displayScale = 0.4;
            passportFinalCanvas.style.width = (size.width * displayScale) + 'px';
            passportFinalCanvas.style.height = (size.height * displayScale) + 'px';
            
            passportFinalCtx.clearRect(0, 0, size.width, size.height);
            passportFinalCtx.imageSmoothingEnabled = true;
            passportFinalCtx.imageSmoothingQuality = 'high';
            
            // Fill background
            if (passportBackground === 'white') {
                passportFinalCtx.fillStyle = '#FFFFFF';
                passportFinalCtx.fillRect(0, 0, size.width, size.height);
            } else if (passportBackground === 'blue') {
                passportFinalCtx.fillStyle = '#3498db';
                passportFinalCtx.fillRect(0, 0, size.width, size.height);
            } else if (passportBackground === 'red') {
                passportFinalCtx.fillStyle = '#e74c3c';
                passportFinalCtx.fillRect(0, 0, size.width, size.height);
            }
            
            // Calculate image dimensions
            const imgAspect = passportImage.width / passportImage.height;
            const canvasAspect = size.width / size.height;
            
            let drawWidth, drawHeight, drawX, drawY;
            
            if (imgAspect > canvasAspect) {
                drawHeight = size.height;
                drawWidth = drawHeight * imgAspect;
                drawX = (size.width - drawWidth) / 2;
                drawY = 0;
            } else {
                drawWidth = size.width;
                drawHeight = drawWidth / imgAspect;
                drawX = 0;
                drawY = (size.height - drawHeight) / 2;
            }
            
            passportFinalCtx.save();
            passportFinalCtx.translate(size.width / 2, size.height / 2);
            passportFinalCtx.rotate((passportRotation * Math.PI) / 180);
            
            passportFinalCtx.beginPath();
            passportFinalCtx.rect(-size.width / 2, -size.height / 2, size.width, size.height);
            passportFinalCtx.clip();
            
            passportFinalCtx.drawImage(passportImage, -drawWidth / 2, -drawHeight / 2, drawWidth, drawHeight);
            passportFinalCtx.restore();
        }
        
        function rotatePassportImage() {
            console.log('Rotating passport image...');
            passportRotation = (passportRotation + 90) % 360;
            drawPassportOriginal();
            drawPassportFinal();
            showStatus('Passport photo rotated!', 'success');
        }
        
        function togglePassportCrop() {
            console.log('Toggling passport crop...');
            passportCropMode = !passportCropMode;
            const overlay = document.getElementById('passportCropOverlay');
            
            if (!overlay) return;
            
            if (passportCropMode) {
                overlay.style.display = 'block';
                setupPassportCropEvents();
                showStatus('Crop mode ON! Face area select करने के लिए drag करें।', 'success');
            } else {
                overlay.style.display = 'none';
                removePassportCropEvents();
                clearPassportCropSelection();
                showStatus('Crop mode OFF।', 'success');
            }
        }
        
        function setupPassportCropEvents() {
            const overlay = document.getElementById('passportCropOverlay');
            if (!overlay) return;
            
            overlay._mousedownHandler = startPassportCrop;
            overlay._mousemoveHandler = updatePassportCrop;
            overlay._mouseupHandler = endPassportCrop;
            overlay._mouseleaveHandler = endPassportCrop;
            
            overlay.addEventListener('mousedown', overlay._mousedownHandler);
            overlay.addEventListener('mousemove', overlay._mousemoveHandler);
            overlay.addEventListener('mouseup', overlay._mouseupHandler);
            overlay.addEventListener('mouseleave', overlay._mouseleaveHandler);
        }
        
        function removePassportCropEvents() {
            const overlay = document.getElementById('passportCropOverlay');
            if (!overlay) return;
            
            if (overlay._mousedownHandler) {
                overlay.removeEventListener('mousedown', overlay._mousedownHandler);
                overlay.removeEventListener('mousemove', overlay._mousemoveHandler);
                overlay.removeEventListener('mouseup', overlay._mouseupHandler);
                overlay.removeEventListener('mouseleave', overlay._mouseleaveHandler);
            }
        }
        
        function clearPassportCropSelection() {
            const overlay = document.getElementById('passportCropOverlay');
            if (!overlay) return;
            
            const selection = overlay.querySelector('.crop-selection');
            if (selection) selection.remove();
        }
        
        function startPassportCrop(e) {
            const rect = e.target.getBoundingClientRect();
            passportCropData.startX = e.clientX - rect.left;
            passportCropData.startY = e.clientY - rect.top;
            passportCropData.isSelecting = true;
            clearPassportCropSelection();
        }
        
        function updatePassportCrop(e) {
            if (!passportCropData.isSelecting) return;
            
            const rect = e.target.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            const overlay = document.getElementById('passportCropOverlay');
            let selection = overlay.querySelector('.crop-selection');
            
            if (!selection) {
                selection = document.createElement('div');
                selection.className = 'crop-selection';
                overlay.appendChild(selection);
            }
            
            const left = Math.min(passportCropData.startX, currentX);
            const top = Math.min(passportCropData.startY, currentY);
            const width = Math.abs(currentX - passportCropData.startX);
            const height = Math.abs(currentY - passportCropData.startY);
            
            selection.style.left = left + 'px';
            selection.style.top = top + 'px';
            selection.style.width = width + 'px';
            selection.style.height = height + 'px';
        }
        
        function endPassportCrop(e) {
            if (!passportCropData.isSelecting) return;
            
            const rect = e.target.getBoundingClientRect();
            passportCropData.endX = e.clientX - rect.left;
            passportCropData.endY = e.clientY - rect.top;
            passportCropData.isSelecting = false;
            
            const overlay = document.getElementById('passportCropOverlay');
            const selection = overlay.querySelector('.crop-selection');
            if (selection && parseInt(selection.style.width) > 20 && parseInt(selection.style.height) > 20) {
                const controls = document.createElement('div');
                controls.className = 'crop-controls';
                controls.innerHTML = `
                    <button class="btn btn-small btn-success" onclick="applyPassportCrop()">✂️ Apply Crop</button>
                    <button class="btn btn-small" onclick="clearPassportCropSelection()">❌ Cancel</button>
                `;
                selection.appendChild(controls);
            }
        }
        
        function applyPassportCrop() {
            console.log('Applying passport crop...');
            
            const overlay = document.getElementById('passportCropOverlay');
            const selection = overlay.querySelector('.crop-selection');
            
            if (!selection) {
                showStatus('कोई crop area select नहीं किया गया!', 'error');
                return;
            }
            
            try {
                const selectionRect = {
                    left: parseInt(selection.style.left) || 0,
                    top: parseInt(selection.style.top) || 0,
                    width: parseInt(selection.style.width) || 0,
                    height: parseInt(selection.style.height) || 0
                };
                
                const overlayRect = overlay.getBoundingClientRect();
                const scaleX = passportOriginalCanvas.width / overlayRect.width;
                const scaleY = passportOriginalCanvas.height / overlayRect.height;
                
                const cropX = Math.round(selectionRect.left * scaleX);
                const cropY = Math.round(selectionRect.top * scaleY);
                const cropWidth = Math.round(selectionRect.width * scaleX);
                const cropHeight = Math.round(selectionRect.height * scaleY);
                
                if (cropWidth < 10 || cropHeight < 10) {
                    showStatus('Crop area बहुत छोटा है!', 'error');
                    return;
                }
                
                const currentDataURL = passportOriginalCanvas.toDataURL('image/png', 1.0);
                const tempImg = new Image();
                
                tempImg.onload = () => {
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = cropWidth;
                    tempCanvas.height = cropHeight;
                    
                    tempCtx.imageSmoothingEnabled = true;
                    tempCtx.imageSmoothingQuality = 'high';
                    tempCtx.drawImage(tempImg, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                    
                    const newImg = new Image();
                    newImg.onload = () => {
                        passportImage = newImg;
                        drawPassportOriginal();
                        drawPassportFinal();
                        togglePassportCrop();
                        showStatus('Passport photo successfully cropped! ✂️', 'success');
                    };
                    newImg.src = tempCanvas.toDataURL('image/png', 1.0);
                };
                
                tempImg.src = currentDataURL;
                
            } catch (error) {
                console.error('Passport crop error:', error);
                showStatus('Cropping में error आया! फिर से try करें।', 'error');
            }
        }
        
        function updatePassportSize() {
            console.log('Updating passport size...');
            drawPassportFinal();
            showStatus('Photo size updated!', 'success');
        }
        
        function changePassportBackground(color) {
            console.log('Changing passport background to:', color);
            passportBackground = color;
            drawPassportFinal();
            showStatus(`Background changed to ${color}!`, 'success');
        }
        
        function drawPassportImage() {
            drawPassportOriginal();
            drawPassportFinal();
        }
        
        function downloadPassportPhoto() {
            console.log('Downloading passport photo...');
            
            if (!passportImage) {
                showStatus('कृपया पहले फोटो अपलोड करें!', 'error');
                return;
            }
            
            try {
                const selectedSize = document.getElementById('passportSizeSelect').value;
                const dataURL = passportFinalCanvas.toDataURL('image/png', 1.0);
                
                const link = document.createElement('a');
                link.download = `Passport_Photo_${selectedSize}_${Date.now()}.png`;
                link.href = dataURL;
                link.click();
                
                showStatus('Passport photo downloaded successfully! 📸', 'success');
            } catch (error) {
                console.error('Download error:', error);
                showStatus('Download में error आया!', 'error');
            }
        }
        
        function showPassportPreview() {
            const previewSection = document.getElementById('passportPreviewSection');
            if (previewSection) previewSection.style.display = 'block';
        }
        
        function updatePassportUploadBox(uploaded) {
            const box = document.getElementById('passportUploadBox');
            if (!box) return;
            
            if (uploaded) {
                box.classList.add('uploaded');
                const icon = box.querySelector('.upload-icon');
                const text = box.querySelector('.upload-text');
                const subtext = box.querySelector('.upload-subtext');
                
                if (icon) icon.textContent = '✅';
                if (text) text.innerHTML = 'Photo Uploaded';
                if (subtext) subtext.innerHTML = 'फोटो अपलोड हो गई!';
            }
        }
        
        // Signature Functions
        function setupSignature() {
            signatureCanvas = document.getElementById('signatureCanvas');
            if (signatureCanvas) {
                signatureCtx = signatureCanvas.getContext('2d');
                signatureCtx.lineCap = 'round';
                signatureCtx.lineJoin = 'round';
                
                // Mouse events
                signatureCanvas.addEventListener('mousedown', startDrawing);
                signatureCanvas.addEventListener('mousemove', draw);
                signatureCanvas.addEventListener('mouseup', stopDrawing);
                signatureCanvas.addEventListener('mouseout', stopDrawing);
                
                // Touch events
                signatureCanvas.addEventListener('touchstart', handleTouch);
                signatureCanvas.addEventListener('touchmove', handleTouch);
                signatureCanvas.addEventListener('touchend', stopDrawing);
                
                // Text input event
                const textInput = document.getElementById('signatureText');
                if (textInput) {
                    textInput.addEventListener('input', updateTextSignature);
                }
            }
        }
        
        function setSignatureMode(mode) {
            signatureMode = mode;
            const drawSection = document.getElementById('drawingSection');
            const textSection = document.getElementById('textSection');
            const drawBtn = document.getElementById('drawModeBtn');
            const textBtn = document.getElementById('textModeBtn');
            
            if (mode === 'draw') {
                drawSection.style.display = 'block';
                textSection.style.display = 'none';
                drawBtn.classList.add('btn-success');
                textBtn.classList.remove('btn-success');
            } else {
                drawSection.style.display = 'none';
                textSection.style.display = 'block';
                textBtn.classList.add('btn-success');
                drawBtn.classList.remove('btn-success');
            }
        }
        
        function startDrawing(e) {
            isDrawing = true;
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            signatureCtx.beginPath();
            signatureCtx.moveTo(x, y);
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            const rect = signatureCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const penSize = document.getElementById('penSize').value;
            const penColor = document.getElementById('penColor').value;
            
            signatureCtx.lineWidth = penSize;
            signatureCtx.strokeStyle = penColor;
            signatureCtx.lineTo(x, y);
            signatureCtx.stroke();
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            signatureCanvas.dispatchEvent(mouseEvent);
        }
        
        function clearSignature() {
            if (signatureCtx) {
                signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                showStatus('Signature cleared!', 'success');
            }
        }
        
        function updateTextSignature() {
            const text = document.getElementById('signatureText').value || 'Your Signature';
            const font = document.getElementById('fontStyle').value;
            const size = document.getElementById('fontSize').value;
            const preview = document.getElementById('textPreview');
            
            preview.style.fontFamily = font + ', cursive';
            preview.style.fontSize = size + 'px';
            preview.textContent = text;
        }
        
        function convertTextToCanvas() {
            const text = document.getElementById('signatureText').value;
            if (!text.trim()) {
                showStatus('कृपया अपना नाम लिखें!', 'error');
                return;
            }
            
            const font = document.getElementById('fontStyle').value;
            const size = document.getElementById('fontSize').value;
            
            signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            signatureCtx.font = `${size}px "${font}", cursive`;
            signatureCtx.fillStyle = '#000000';
            signatureCtx.textAlign = 'center';
            signatureCtx.textBaseline = 'middle';
            
            signatureCtx.fillText(text, signatureCanvas.width / 2, signatureCanvas.height / 2);
            
            setSignatureMode('draw');
            showStatus('Text signature created! आप इसे edit भी कर सकते हैं।', 'success');
        }
        
        function downloadSignature(format) {
            if (!signatureCanvas) return;
            
            // Check if canvas is empty
            const imageData = signatureCtx.getImageData(0, 0, signatureCanvas.width, signatureCanvas.height);
            const isEmpty = !imageData.data.some(channel => channel !== 0);
            
            if (isEmpty) {
                showStatus('कृपया पहले signature बनाएं!', 'error');
                return;
            }
            
            try {
                let dataURL;
                let fileName;
                
                if (format === 'png') {
                    dataURL = signatureCanvas.toDataURL('image/png');
                    fileName = `Signature_${Date.now()}.png`;
                } else if (format === 'jpg') {
                    // Create white background for JPG
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = signatureCanvas.width;
                    tempCanvas.height = signatureCanvas.height;
                    
                    tempCtx.fillStyle = 'white';
                    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                    tempCtx.drawImage(signatureCanvas, 0, 0);
                    
                    dataURL = tempCanvas.toDataURL('image/jpeg', 0.9);
                    fileName = `Signature_${Date.now()}.jpg`;
                } else if (format === 'svg') {
                    // Simple SVG conversion
                    const svgData = `<svg xmlns="http://www.w3.org/2000/svg" width="${signatureCanvas.width}" height="${signatureCanvas.height}">
                        <foreignObject width="100%" height="100%">
                            <div xmlns="http://www.w3.org/1999/xhtml">
                                <img src="${signatureCanvas.toDataURL()}" width="${signatureCanvas.width}" height="${signatureCanvas.height}"/>
                            </div>
                        </foreignObject>
                    </svg>`;
                    
                    const blob = new Blob([svgData], { type: 'image/svg+xml' });
                    dataURL = URL.createObjectURL(blob);
                    fileName = `Signature_${Date.now()}.svg`;
                }
                
                const link = document.createElement('a');
                link.download = fileName;
                link.href = dataURL;
                link.click();
                
                if (format === 'svg') {
                    URL.revokeObjectURL(dataURL);
                }
                
                showStatus(`Signature downloaded as ${format.toUpperCase()}! ✅`, 'success');
            } catch (error) {
                console.error('Download error:', error);
                showStatus('Download में error आया!', 'error');
            }
        }
        
        // Compression Functions
        function setupCompression() {
            const compressInput = document.getElementById('compressFileInput');
            if (compressInput) {
                compressInput.addEventListener('change', handleCompressUpload);
            }
            
            setupDragDrop('compressUploadBox', 'compress');
        }
        
        function handleCompressUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            compressImages = [];
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    compressImages.push(file);
                }
            });
            
            if (compressImages.length === 0) {
                showStatus('कृपया केवल image files अपलोड करें!', 'error');
                return;
            }
            
            document.getElementById('compressionSettings').style.display = 'block';
            showStatus(`${compressImages.length} images अपलोड हो गईं!`, 'success');
        }
        
        function updateQualityValue() {
            const value = document.getElementById('qualitySlider').value;
            document.getElementById('qualityValue').textContent = value + '%';
        }
        
        function compressAllImages() {
            if (compressImages.length === 0) {
                showStatus('कृपया पहले images अपलोड करें!', 'error');
                return;
            }
            
            const quality = document.getElementById('qualitySlider').value / 100;
            const maxWidth = parseInt(document.getElementById('maxWidth').value) || 1920;
            const format = document.getElementById('outputFormat').value;
            
            compressedResults = [];
            let processed = 0;
            
            showStatus('Images compress हो रही हैं...', 'success');
            
            compressImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Calculate new dimensions
                        let { width, height } = calculateDimensions(img.width, img.height, maxWidth, maxWidth);
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const mimeType = format === 'jpeg' ? 'image/jpeg' : 
                                       format === 'png' ? 'image/png' : 'image/webp';
                        
                        canvas.toBlob((blob) => {
                            const originalSize = file.size;
                            const compressedSize = blob.size;
                            const reduction = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
                            
                            compressedResults.push({
                                originalName: file.name,
                                originalSize: originalSize,
                                compressedSize: compressedSize,
                                reduction: reduction,
                                blob: blob,
                                dataURL: URL.createObjectURL(blob),
                                format: format
                            });
                            
                            processed++;
                            if (processed === compressImages.length) {
                                displayCompressedResults();
                            }
                        }, mimeType, quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function displayCompressedResults() {
            const resultsList = document.getElementById('compressedImagesList');
            const resultsSection = document.getElementById('compressionResults');
            
            resultsList.innerHTML = '';
            
            compressedResults.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.innerHTML = `
                    <h4>${result.originalName}</h4>
                    <img src="${result.dataURL}" style="max-width: 100%; max-height: 200px; border-radius: 8px; margin: 10px 0;">
                    <div style="text-align: left; font-size: 0.9rem; color: #666;">
                        <p><strong>Original:</strong> ${formatFileSize(result.originalSize)}</p>
                        <p><strong>Compressed:</strong> ${formatFileSize(result.compressedSize)}</p>
                        <p><strong>Reduction:</strong> ${result.reduction}%</p>
                    </div>
                    <button class="btn btn-small btn-success" onclick="downloadCompressed(${index})">
                        📥 Download
                    </button>
                `;
                resultsList.appendChild(card);
            });
            
            resultsSection.style.display = 'block';
            showStatus(`${compressedResults.length} images successfully compressed! 🗜️`, 'success');
        }
        
        function downloadCompressed(index) {
            const result = compressedResults[index];
            const link = document.createElement('a');
            link.download = `compressed_${result.originalName.split('.')[0]}.${result.format}`;
            link.href = result.dataURL;
            link.click();
        }
        
        function downloadAllCompressed() {
            compressedResults.forEach((result, index) => {
                setTimeout(() => downloadCompressed(index), index * 100);
            });
            showStatus('All compressed images downloading...', 'success');
        }
        
        function clearCompressedImages() {
            compressImages = [];
            compressedResults = [];
            document.getElementById('compressionSettings').style.display = 'none';
            document.getElementById('compressionResults').style.display = 'none';
            document.getElementById('compressFileInput').value = '';
            showStatus('All cleared!', 'success');
        }
        
        // Converter Functions
        function setupConverter() {
            const converterInput = document.getElementById('converterFileInput');
            if (converterInput) {
                converterInput.addEventListener('change', handleConverterUpload);
            }
            
            setupDragDrop('converterUploadBox', 'converter');
        }
        
        function setupPdfConverter() {
            console.log('Setting up PDF converter...');
            
            const pdfImagesInput = document.getElementById('pdfImagesFileInput');
            if (pdfImagesInput) {
                pdfImagesInput.addEventListener('change', handlePdfImagesUpload);
                console.log('PDF images input listener added');
            } else {
                console.error('PDF images input not found');
            }
            
            const pdfFileInput = document.getElementById('pdfFileInput');
            if (pdfFileInput) {
                pdfFileInput.addEventListener('change', handlePdfFileUpload);
                console.log('PDF file input listener added');
            } else {
                console.error('PDF file input not found');
            }
            
            setupDragDrop('pdfImagesUploadBox', 'pdfImages');
            setupDragDrop('pdfFileUploadBox', 'pdfFile');
            console.log('PDF converter setup complete');
        }
        
        function handleConverterUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            converterImages = [];
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    converterImages.push(file);
                }
            });
            
            if (converterImages.length === 0) {
                showStatus('कृपया केवल image files अपलोड करें!', 'error');
                return;
            }
            
            displayConverterPreviews();
            document.getElementById('conversionSettings').style.display = 'block';
            showStatus(`${converterImages.length} images अपलोड हो गईं!`, 'success');
        }
        
        function displayConverterPreviews() {
            const previewList = document.getElementById('converterPreviewList');
            const previewSection = document.getElementById('converterPreviewSection');
            
            previewList.innerHTML = '';
            
            converterImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const card = document.createElement('div');
                    card.className = 'preview-card';
                    card.innerHTML = `
                        <h4>${file.name}</h4>
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px; margin: 10px 0;">
                        <div style="text-align: left; font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                            <p><strong>Size:</strong> ${formatFileSize(file.size)}</p>
                            <p><strong>Type:</strong> ${file.type}</p>
                        </div>
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-small" onclick="removeConverterImage(${index})">🗑️ Remove</button>
                        </div>
                    `;
                    previewList.appendChild(card);
                };
                reader.readAsDataURL(file);
            });
            
            previewSection.style.display = 'block';
        }
        
        function removeConverterImage(index) {
            converterImages.splice(index, 1);
            if (converterImages.length === 0) {
                document.getElementById('converterPreviewSection').style.display = 'none';
                document.getElementById('conversionSettings').style.display = 'none';
            } else {
                displayConverterPreviews();
            }
            showStatus('Image removed!', 'success');
        }
        
        function updateConvertQualityValue() {
            const value = document.getElementById('convertQualitySlider').value;
            document.getElementById('convertQualityValue').textContent = value + '%';
        }
        
        function convertAllImages() {
            if (converterImages.length === 0) {
                showStatus('कृपया पहले images अपलोड करें!', 'error');
                return;
            }
            
            const format = document.getElementById('convertFormat').value;
            const quality = document.getElementById('convertQualitySlider').value / 100;
            const newWidth = parseInt(document.getElementById('convertWidth').value) || null;
            const newHeight = parseInt(document.getElementById('convertHeight').value) || null;
            
            convertedResults = [];
            let processed = 0;
            
            showStatus('Images convert हो रही हैं...', 'success');
            
            if (format === 'pdf') {
                convertToPDF();
                return;
            }
            
            converterImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        let width = img.width;
                        let height = img.height;
                        
                        if (newWidth && newHeight) {
                            width = newWidth;
                            height = newHeight;
                        } else if (newWidth) {
                            height = (img.height * newWidth) / img.width;
                            width = newWidth;
                        } else if (newHeight) {
                            width = (img.width * newHeight) / img.height;
                            height = newHeight;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        
                        if (format === 'jpeg') {
                            ctx.fillStyle = 'white';
                            ctx.fillRect(0, 0, width, height);
                        }
                        
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const mimeType = format === 'jpeg' ? 'image/jpeg' : 
                                       format === 'png' ? 'image/png' : 
                                       format === 'webp' ? 'image/webp' : 'image/bmp';
                        
                        canvas.toBlob((blob) => {
                            convertedResults.push({
                                originalName: file.name,
                                blob: blob,
                                dataURL: URL.createObjectURL(blob),
                                format: format,
                                width: width,
                                height: height
                            });
                            
                            processed++;
                            if (processed === converterImages.length) {
                                displayConvertedResults();
                            }
                        }, mimeType, quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function convertToPDF() {
            const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            let processed = 0;
            
            converterImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        if (index > 0) pdf.addPage();
                        
                        const imgAspect = img.width / img.height;
                        const pageAspect = pageWidth / pageHeight;
                        
                        let width, height, x, y;
                        
                        if (imgAspect > pageAspect) {
                            width = pageWidth - 20;
                            height = width / imgAspect;
                            x = 10;
                            y = (pageHeight - height) / 2;
                        } else {
                            height = pageHeight - 20;
                            width = height * imgAspect;
                            x = (pageWidth - width) / 2;
                            y = 10;
                        }
                        
                        pdf.addImage(e.target.result, 'JPEG', x, y, width, height);
                        
                        processed++;
                        if (processed === converterImages.length) {
                            pdf.save(`Converted_Images_${Date.now()}.pdf`);
                            showStatus('Images successfully converted to PDF! 📄', 'success');
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function displayConvertedResults() {
            const resultsList = document.getElementById('convertedImagesList');
            const resultsSection = document.getElementById('conversionResults');
            
            resultsList.innerHTML = '';
            
            convertedResults.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.innerHTML = `
                    <h4>${result.originalName}</h4>
                    <img src="${result.dataURL}" style="max-width: 100%; max-height: 200px; border-radius: 8px; margin: 10px 0;">
                    <div style="text-align: left; font-size: 0.9rem; color: #666;">
                        <p><strong>Format:</strong> ${result.format.toUpperCase()}</p>
                        <p><strong>Size:</strong> ${result.width} × ${result.height}px</p>
                    </div>
                    <button class="btn btn-small btn-success" onclick="downloadConverted(${index})">
                        📥 Download
                    </button>
                `;
                resultsList.appendChild(card);
            });
            
            resultsSection.style.display = 'block';
            showStatus(`${convertedResults.length} images successfully converted! 🔄`, 'success');
        }
        
        function downloadConverted(index) {
            const result = convertedResults[index];
            const link = document.createElement('a');
            const extension = result.format === 'jpeg' ? 'jpg' : result.format;
            link.download = `converted_${result.originalName.split('.')[0]}.${extension}`;
            link.href = result.dataURL;
            link.click();
        }
        
        function downloadAllConverted() {
            convertedResults.forEach((result, index) => {
                setTimeout(() => downloadConverted(index), index * 100);
            });
            showStatus('All converted images downloading...', 'success');
        }
        
        function clearConvertedImages() {
            converterImages = [];
            convertedResults = [];
            document.getElementById('conversionSettings').style.display = 'none';
            document.getElementById('conversionResults').style.display = 'none';
            document.getElementById('converterFileInput').value = '';
            showStatus('All cleared!', 'success');
        }
        
        // PDF Converter Functions
        function setPdfMode(mode) {
            pdfConverterMode = mode;
            const imageToPdfSection = document.getElementById('imageToPdfSection');
            const pdfToImageSection = document.getElementById('pdfToImageSection');
            const imageToPdfBtn = document.getElementById('imageToPdfBtn');
            const pdfToImageBtn = document.getElementById('pdfToImageBtn');
            
            if (mode === 'imageToPdf') {
                imageToPdfSection.style.display = 'block';
                pdfToImageSection.style.display = 'none';
                imageToPdfBtn.classList.add('btn-success');
                pdfToImageBtn.classList.remove('btn-success');
            } else {
                imageToPdfSection.style.display = 'none';
                pdfToImageSection.style.display = 'block';
                pdfToImageBtn.classList.add('btn-success');
                imageToPdfBtn.classList.remove('btn-success');
            }
        }
        
        function handlePdfImagesUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            pdfImages = [];
            pdfImageEditData = {};
            
            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    pdfImages.push(file);
                    pdfImageEditData[index] = {
                        brightness: 100,
                        contrast: 100,
                        rotation: 0,
                        quality: 90
                    };
                }
            });
            
            if (pdfImages.length === 0) {
                showStatus('कृपया केवल image files अपलोड करें!', 'error');
                return;
            }
            
            displayPdfImagesPreviews();
            showStatus(`${pdfImages.length} images अपलोड हो गईं!`, 'success');
        }
        
        function displayPdfImagesPreviews() {
            const previewList = document.getElementById('pdfImagesPreviewList');
            const previewSection = document.getElementById('pdfImagesPreviewSection');
            
            previewList.innerHTML = '';
            
            // Add bulk edit controls at the top
            const bulkEditCard = document.createElement('div');
            bulkEditCard.className = 'preview-card';
            bulkEditCard.style.background = 'linear-gradient(135deg, #e3f2fd, #bbdefb)';
            bulkEditCard.innerHTML = `
                <h3 style="color: #1976d2; margin-bottom: 20px;">🎛️ Bulk Edit Controls</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Bulk Brightness: <span id="bulkBrightnessValue">100%</span>
                        </label>
                        <input type="range" id="bulkBrightness" min="0" max="200" value="100" 
                               onchange="updateBulkBrightness()" style="width: 100%;">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Bulk Contrast: <span id="bulkContrastValue">100%</span>
                        </label>
                        <input type="range" id="bulkContrast" min="0" max="200" value="100" 
                               onchange="updateBulkContrast()" style="width: 100%;">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Bulk Quality: <span id="bulkQualityValue">90%</span>
                        </label>
                        <input type="range" id="bulkQuality" min="10" max="100" value="90" 
                               onchange="updateBulkQuality()" style="width: 100%;">
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 15px;">
                    <button class="btn btn-small btn-warning" onclick="bulkRotateImages()">🔄 Rotate All</button>
                    <button class="btn btn-small btn-danger" onclick="bulkEnhanceImages()">✨ Enhance All</button>
                    <button class="btn btn-small" onclick="bulkResetImages()">🧹 Reset All</button>
                    <button class="btn btn-small btn-success" onclick="selectAllImages()">☑️ Select All</button>
                    <button class="btn btn-small" onclick="deselectAllImages()">☐ Deselect All</button>
                </div>
                
                <div style="text-align: center; font-size: 0.9rem; color: #666;">
                    <strong>Selected:</strong> <span id="selectedCount">${pdfImages.length}</span> / ${pdfImages.length} images
                </div>
            `;
            previewList.appendChild(bulkEditCard);
            
            pdfImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const editData = pdfImageEditData[index];
                    const card = document.createElement('div');
                    card.className = 'preview-card';
                    card.id = `pdfImageCard${index}`;
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; flex: 1;">${file.name}</h4>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                    <input type="checkbox" id="pdfImageSelect${index}" checked 
                                           onchange="toggleImageSelection(${index})" 
                                           style="transform: scale(1.2);">
                                    <span style="font-size: 0.9rem;">Include</span>
                                </label>
                                <span style="font-size: 0.8rem; color: #666;">${formatFileSize(file.size)}</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <canvas id="pdfImageCanvas${index}" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;"></canvas>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">
                                    Brightness: <span id="pdfBrightnessValue${index}">${editData.brightness}%</span>
                                </label>
                                <input type="range" id="pdfBrightness${index}" min="0" max="200" value="${editData.brightness}" 
                                       onchange="updatePdfImageEdit(${index}, 'brightness')" style="width: 100%;">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">
                                    Contrast: <span id="pdfContrastValue${index}">${editData.contrast}%</span>
                                </label>
                                <input type="range" id="pdfContrast${index}" min="0" max="200" value="${editData.contrast}" 
                                       onchange="updatePdfImageEdit(${index}, 'contrast')" style="width: 100%;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem;">
                                Quality: <span id="pdfQualityValue${index}">${editData.quality}%</span>
                            </label>
                            <input type="range" id="pdfQuality${index}" min="10" max="100" value="${editData.quality}" 
                                   onchange="updatePdfImageEdit(${index}, 'quality')" style="width: 100%;">
                        </div>
                        
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-small btn-warning" onclick="rotatePdfImage(${index})">🔄 Rotate</button>
                            <button class="btn btn-small btn-danger" onclick="enhancePdfImage(${index})">✨ Enhance</button>
                            <button class="btn btn-small" onclick="resetPdfImage(${index})">🧹 Reset</button>
                            <button class="btn btn-small" onclick="duplicatePdfImage(${index})">📋 Duplicate</button>
                            <button class="btn btn-small" onclick="removePdfImage(${index})">🗑️ Remove</button>
                        </div>
                        
                        <div style="margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 5px; font-size: 0.8rem; color: #666;">
                            <strong>Rotation:</strong> ${editData.rotation}° | 
                            <strong>Status:</strong> <span id="pdfImageStatus${index}">Ready</span>
                        </div>
                    `;
                    previewList.appendChild(card);
                    
                    // Draw image on canvas
                    setTimeout(() => drawPdfImageOnCanvas(index, e.target.result), 100);
                };
                reader.readAsDataURL(file);
            });
            
            previewSection.style.display = 'block';
        }
        
        function updateBulkBrightness() {
            const value = document.getElementById('bulkBrightness').value;
            document.getElementById('bulkBrightnessValue').textContent = value + '%';
            
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    pdfImageEditData[index].brightness = parseInt(value);
                    document.getElementById(`pdfBrightness${index}`).value = value;
                    document.getElementById(`pdfBrightnessValue${index}`).textContent = value + '%';
                    
                    const reader = new FileReader();
                    reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
                    reader.readAsDataURL(pdfImages[index]);
                }
            });
        }
        
        function updateBulkContrast() {
            const value = document.getElementById('bulkContrast').value;
            document.getElementById('bulkContrastValue').textContent = value + '%';
            
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    pdfImageEditData[index].contrast = parseInt(value);
                    document.getElementById(`pdfContrast${index}`).value = value;
                    document.getElementById(`pdfContrastValue${index}`).textContent = value + '%';
                    
                    const reader = new FileReader();
                    reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
                    reader.readAsDataURL(pdfImages[index]);
                }
            });
        }
        
        function updateBulkQuality() {
            const value = document.getElementById('bulkQuality').value;
            document.getElementById('bulkQualityValue').textContent = value + '%';
            
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    pdfImageEditData[index].quality = parseInt(value);
                    document.getElementById(`pdfQuality${index}`).value = value;
                    document.getElementById(`pdfQualityValue${index}`).textContent = value + '%';
                }
            });
        }
        
        function bulkRotateImages() {
            let rotatedCount = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    rotatePdfImage(index);
                    rotatedCount++;
                }
            });
            showStatus(`${rotatedCount} images rotated!`, 'success');
        }
        
        function bulkEnhanceImages() {
            let enhancedCount = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    enhancePdfImage(index);
                    enhancedCount++;
                }
            });
            showStatus(`${enhancedCount} images enhanced!`, 'success');
        }
        
        function bulkResetImages() {
            let resetCount = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    resetPdfImage(index);
                    resetCount++;
                }
            });
            showStatus(`${resetCount} images reset!`, 'success');
        }
        
        function selectAllImages() {
            let count = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox) {
                    checkbox.checked = true;
                    toggleImageSelection(index);
                    count++;
                }
            });
            updateSelectedCount();
            showStatus(`All ${count} images selected!`, 'success');
        }
        
        function deselectAllImages() {
            let count = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox) {
                    checkbox.checked = false;
                    toggleImageSelection(index);
                    count++;
                }
            });
            updateSelectedCount();
            showStatus(`All ${count} images deselected!`, 'success');
        }
        
        function toggleImageSelection(index) {
            const checkbox = document.getElementById(`pdfImageSelect${index}`);
            const card = document.getElementById(`pdfImageCard${index}`);
            
            if (checkbox.checked) {
                card.style.opacity = '1';
                card.style.filter = 'none';
                card.style.border = '2px solid #4CAF50';
            } else {
                card.style.opacity = '0.6';
                card.style.filter = 'grayscale(50%)';
                card.style.border = '2px solid #ddd';
            }
            
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            let selectedCount = 0;
            pdfImages.forEach((_, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    selectedCount++;
                }
            });
            
            const countElement = document.getElementById('selectedCount');
            if (countElement) {
                countElement.textContent = selectedCount;
            }
        }
        
        function duplicatePdfImage(index) {
            const originalFile = pdfImages[index];
            const originalEditData = pdfImageEditData[index];
            
            // Create a copy of the file
            const newFile = new File([originalFile], `Copy_of_${originalFile.name}`, {
                type: originalFile.type,
                lastModified: Date.now()
            });
            
            // Add to arrays
            pdfImages.push(newFile);
            const newIndex = pdfImages.length - 1;
            pdfImageEditData[newIndex] = { ...originalEditData };
            
            // Refresh display
            displayPdfImagesPreviews();
            showStatus(`Image duplicated! Now you have ${pdfImages.length} images.`, 'success');
        }
        
        function drawPdfImageOnCanvas(index, imageSrc) {
            const canvas = document.getElementById(`pdfImageCanvas${index}`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = () => {
                const maxWidth = 300;
                const maxHeight = 200;
                let { width, height } = calculateDimensions(img.width, img.height, maxWidth, maxHeight);
                
                canvas.width = width;
                canvas.height = height;
                
                const editData = pdfImageEditData[index];
                
                ctx.clearRect(0, 0, width, height);
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.filter = `brightness(${editData.brightness}%) contrast(${editData.contrast}%)`;
                
                ctx.save();
                ctx.translate(width / 2, height / 2);
                ctx.rotate((editData.rotation * Math.PI) / 180);
                ctx.drawImage(img, -width / 2, -height / 2, width, height);
                ctx.restore();
            };
            
            img.src = imageSrc;
        }
        
        function updatePdfImageEdit(index, property) {
            const value = document.getElementById(`pdf${property.charAt(0).toUpperCase() + property.slice(1)}${index}`).value;
            pdfImageEditData[index][property] = parseInt(value);
            document.getElementById(`pdf${property.charAt(0).toUpperCase() + property.slice(1)}Value${index}`).textContent = value + '%';
            
            // Redraw canvas
            const canvas = document.getElementById(`pdfImageCanvas${index}`);
            const reader = new FileReader();
            reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
            reader.readAsDataURL(pdfImages[index]);
        }
        
        function rotatePdfImage(index) {
            pdfImageEditData[index].rotation = (pdfImageEditData[index].rotation + 90) % 360;
            const reader = new FileReader();
            reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
            reader.readAsDataURL(pdfImages[index]);
            showStatus('Image rotated!', 'success');
        }
        
        function enhancePdfImage(index) {
            pdfImageEditData[index].brightness = 110;
            pdfImageEditData[index].contrast = 120;
            
            document.getElementById(`pdfBrightness${index}`).value = 110;
            document.getElementById(`pdfContrast${index}`).value = 120;
            document.getElementById(`pdfBrightnessValue${index}`).textContent = '110%';
            document.getElementById(`pdfContrastValue${index}`).textContent = '120%';
            
            const reader = new FileReader();
            reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
            reader.readAsDataURL(pdfImages[index]);
            showStatus('Image enhanced!', 'success');
        }
        
        function resetPdfImage(index) {
            pdfImageEditData[index] = {
                brightness: 100,
                contrast: 100,
                rotation: 0,
                quality: 90
            };
            
            document.getElementById(`pdfBrightness${index}`).value = 100;
            document.getElementById(`pdfContrast${index}`).value = 100;
            document.getElementById(`pdfBrightnessValue${index}`).textContent = '100%';
            document.getElementById(`pdfContrastValue${index}`).textContent = '100%';
            
            const reader = new FileReader();
            reader.onload = (e) => drawPdfImageOnCanvas(index, e.target.result);
            reader.readAsDataURL(pdfImages[index]);
            showStatus('Image reset!', 'success');
        }
        
        function removePdfImage(index) {
            pdfImages.splice(index, 1);
            delete pdfImageEditData[index];
            
            // Reindex remaining images
            const newEditData = {};
            Object.keys(pdfImageEditData).forEach((key, newIndex) => {
                if (parseInt(key) > index) {
                    newEditData[newIndex] = pdfImageEditData[key];
                } else if (parseInt(key) < index) {
                    newEditData[key] = pdfImageEditData[key];
                }
            });
            pdfImageEditData = newEditData;
            
            if (pdfImages.length === 0) {
                document.getElementById('pdfImagesPreviewSection').style.display = 'none';
            } else {
                displayPdfImagesPreviews();
            }
            showStatus('Image removed!', 'success');
        }
        
        function updatePdfQualityValue() {
            const value = document.getElementById('pdfQualitySlider').value;
            document.getElementById('pdfQualityValue').textContent = value + '%';
        }
        
        function updatePdfToImageQualityValue() {
            const value = document.getElementById('pdfToImageQualitySlider').value;
            document.getElementById('pdfToImageQualityValue').textContent = value + '%';
        }
        
        function createPdfFromImages() {
            if (pdfImages.length === 0) {
                showStatus('कृपया पहले images अपलोड करें!', 'error');
                return;
            }
            
            // Get selected images only
            const selectedImages = [];
            const selectedEditData = [];
            
            pdfImages.forEach((file, index) => {
                const checkbox = document.getElementById(`pdfImageSelect${index}`);
                if (checkbox && checkbox.checked) {
                    selectedImages.push(file);
                    selectedEditData.push(pdfImageEditData[index]);
                }
            });
            
            if (selectedImages.length === 0) {
                showStatus('कृपया कम से कम एक image select करें!', 'error');
                return;
            }
            
            showStatus(`${selectedImages.length} selected images से PDF बनाई जा रही है...`, 'success');
            
            const pageSize = document.getElementById('pdfPageSize').value;
            const orientation = document.getElementById('pdfOrientation').value;
            const imagesPerPage = parseInt(document.getElementById('imagesPerPage').value);
            
            const pdf = new window.jspdf.jsPDF(orientation, 'mm', pageSize);
            let processed = 0;
            let pdfPageCount = 0;
            
            const processImage = (index) => {
                if (index >= selectedImages.length) {
                    // All images processed, save PDF
                    pdf.save(`Images_to_PDF_${selectedImages.length}_images_${Date.now()}.pdf`);
                    showStatus(`PDF successfully created with ${selectedImages.length} images! 📄`, 'success');
                    
                    // Update status for processed images
                    pdfImages.forEach((_, originalIndex) => {
                        const checkbox = document.getElementById(`pdfImageSelect${originalIndex}`);
                        const statusElement = document.getElementById(`pdfImageStatus${originalIndex}`);
                        if (checkbox && checkbox.checked && statusElement) {
                            statusElement.textContent = 'Added to PDF ✅';
                            statusElement.style.color = '#27ae60';
                        }
                    });
                    
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // Create canvas with edits applied
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        const editData = selectedEditData[index];
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.filter = `brightness(${editData.brightness}%) contrast(${editData.contrast}%)`;
                        
                        ctx.save();
                        ctx.translate(canvas.width / 2, canvas.height / 2);
                        ctx.rotate((editData.rotation * Math.PI) / 180);
                        ctx.drawImage(img, -canvas.width / 2, -canvas.height / 2);
                        ctx.restore();
                        
                        // Add to PDF
                        const pageWidth = pdf.internal.pageSize.getWidth();
                        const pageHeight = pdf.internal.pageSize.getHeight();
                        
                        let x, y, width, height;
                        
                        if (imagesPerPage === 1) {
                            if (index > 0) pdf.addPage();
                            pdfPageCount++;
                            
                            const imgAspect = canvas.width / canvas.height;
                            const pageAspect = pageWidth / pageHeight;
                            
                            if (imgAspect > pageAspect) {
                                width = pageWidth - 20;
                                height = width / imgAspect;
                                x = 10;
                                y = (pageHeight - height) / 2;
                            } else {
                                height = pageHeight - 20;
                                width = height * imgAspect;
                                x = (pageWidth - width) / 2;
                                y = 10;
                            }
                        } else if (imagesPerPage === 2) {
                            if (index % 2 === 0 && index > 0) {
                                pdf.addPage();
                                pdfPageCount++;
                            }
                            
                            width = (pageWidth - 30) / 2;
                            height = width / (canvas.width / canvas.height);
                            
                            // Limit height to fit page
                            const maxHeight = pageHeight - 20;
                            if (height > maxHeight) {
                                height = maxHeight;
                                width = height * (canvas.width / canvas.height);
                            }
                            
                            x = index % 2 === 0 ? 10 : pageWidth / 2 + 5;
                            y = (pageHeight - height) / 2;
                        } else if (imagesPerPage === 4) {
                            if (index % 4 === 0 && index > 0) {
                                pdf.addPage();
                                pdfPageCount++;
                            }
                            
                            width = (pageWidth - 30) / 2;
                            height = (pageHeight - 30) / 2;
                            
                            // Maintain aspect ratio
                            const imgAspect = canvas.width / canvas.height;
                            if (width / height > imgAspect) {
                                width = height * imgAspect;
                            } else {
                                height = width / imgAspect;
                            }
                            
                            const col = index % 2;
                            const row = Math.floor((index % 4) / 2);
                            
                            x = col === 0 ? 10 : pageWidth / 2 + 5;
                            y = row === 0 ? 10 : pageHeight / 2 + 5;
                        }
                        
                        const quality = editData.quality / 100;
                        const imageData = canvas.toDataURL('image/jpeg', quality);
                        pdf.addImage(imageData, 'JPEG', x, y, width, height);
                        
                        // Update progress
                        const progress = Math.round(((index + 1) / selectedImages.length) * 100);
                        showStatus(`PDF बनाई जा रही है... ${progress}% (${index + 1}/${selectedImages.length})`, 'success');
                        
                        // Process next image
                        processImage(index + 1);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(selectedImages[index]);
            };
            
            processImage(0);
        }
        
        function clearPdfImages() {
            pdfImages = [];
            pdfImageEditData = {};
            document.getElementById('pdfImagesPreviewSection').style.display = 'none';
            document.getElementById('pdfImagesFileInput').value = '';
            showStatus('All cleared!', 'success');
        }
        
        function handlePdfFileUpload(event) {
            console.log('PDF file upload started...');
            const file = event.target.files[0];
            
            if (!file) {
                showStatus('कृपया PDF file select करें!', 'error');
                return;
            }
            
            console.log('File details:', {
                name: file.name,
                type: file.type,
                size: file.size
            });
            
            // More comprehensive file type checking
            const fileName = file.name.toLowerCase();
            const fileExtension = fileName.split('.').pop();
            const validExtensions = ['pdf'];
            const validMimeTypes = ['application/pdf', 'application/x-pdf', 'application/acrobat', 'applications/vnd.pdf', 'text/pdf', 'text/x-pdf'];
            
            const hasValidExtension = validExtensions.includes(fileExtension);
            const hasValidMimeType = validMimeTypes.includes(file.type) || file.type === '';
            
            console.log('Validation:', {
                extension: fileExtension,
                hasValidExtension,
                mimeType: file.type,
                hasValidMimeType
            });
            
            if (!hasValidExtension && !hasValidMimeType) {
                showStatus(`Invalid file type! File: ${file.name}, Type: ${file.type || 'unknown'}. कृपया केवल PDF file अपलोड करें!`, 'error');
                return;
            }
            
            // Check file size (max 50MB)
            const maxSize = 50 * 1024 * 1024; // 50MB
            if (file.size > maxSize) {
                showStatus(`PDF file बहुत बड़ी है! Size: ${formatFileSize(file.size)}. कृपया 50MB से छोटी file अपलोड करें।`, 'error');
                return;
            }
            
            // Check minimum file size (at least 1KB)
            if (file.size < 1024) {
                showStatus('PDF file बहुत छोटी है! कृपया valid PDF file अपलोड करें।', 'error');
                return;
            }
            
            pdfFile = file;
            console.log('PDF file accepted:', file.name);
            
            // Update upload box to show success
            const uploadBox = document.getElementById('pdfFileUploadBox');
            if (uploadBox) {
                uploadBox.classList.add('uploaded');
                const icon = uploadBox.querySelector('.upload-icon');
                const text = uploadBox.querySelector('.upload-text');
                const subtext = uploadBox.querySelector('.upload-subtext');
                
                if (icon) icon.textContent = '✅';
                if (text) text.innerHTML = 'PDF File Uploaded Successfully';
                if (subtext) subtext.innerHTML = `📄 ${file.name}<br>📊 Size: ${formatFileSize(file.size)}`;
            }
            
            // Show preview section
            const previewSection = document.getElementById('pdfPreviewSection');
            if (previewSection) {
                previewSection.style.display = 'block';
            }
            
            // Create preview for PDF file
            displayPdfFilePreview();
            showStatus(`✅ PDF file "${file.name}" सफलतापूर्वक अपलोड हो गई! (${formatFileSize(file.size)}) अब settings adjust करें और convert करें।`, 'success');
        }
        
        function displayPdfFilePreview() {
            const pdfPagesPreview = document.getElementById('pdfPagesPreview');
            const pdfPagesList = document.getElementById('pdfPagesList');
            
            pdfPagesList.innerHTML = '';
            
            // Create preview cards for PDF pages (simulated)
            const estimatedPages = Math.floor(pdfFile.size / 50000) + 1; // Rough estimate
            
            for (let i = 0; i < Math.min(estimatedPages, 10); i++) {
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.innerHTML = `
                    <h4>Page ${i + 1}</h4>
                    <div style="margin-bottom: 15px;">
                        <div style="width: 200px; height: 280px; background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <div style="text-align: center; color: #6c757d;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">📄</div>
                                <div>PDF Page ${i + 1}</div>
                                <div style="font-size: 0.8rem; margin-top: 5px;">${pdfFile.name}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Quality: <span id="pdfPageQuality${i}">90%</span>
                        </label>
                        <input type="range" id="pdfPageQualitySlider${i}" min="10" max="100" value="90" 
                               onchange="updatePdfPageQuality(${i})" style="width: 100%;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Include in conversion:</label>
                        <input type="checkbox" id="pdfPageInclude${i}" checked onchange="togglePdfPageInclude(${i})" 
                               style="transform: scale(1.2); margin-right: 8px;">
                        <label for="pdfPageInclude${i}">Include this page</label>
                    </div>
                    
                    <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-small btn-success" onclick="previewPdfPage(${i})">👁️ Preview</button>
                        <button class="btn btn-small btn-warning" onclick="rotatePdfPage(${i})">🔄 Rotate</button>
                        <button class="btn btn-small btn-danger" onclick="enhancePdfPage(${i})">✨ Enhance</button>
                    </div>
                `;
                pdfPagesList.appendChild(card);
            }
            
            if (estimatedPages > 10) {
                const moreCard = document.createElement('div');
                moreCard.className = 'preview-card';
                moreCard.innerHTML = `
                    <div style="text-align: center; color: #6c757d; padding: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">📚</div>
                        <div>और ${estimatedPages - 10} pages...</div>
                        <div style="font-size: 0.9rem; margin-top: 10px;">सभी pages convert होंगे</div>
                    </div>
                `;
                pdfPagesList.appendChild(moreCard);
            }
            
            pdfPagesPreview.style.display = 'block';
        }
        
        function updatePdfPageQuality(pageIndex) {
            const value = document.getElementById(`pdfPageQualitySlider${pageIndex}`).value;
            document.getElementById(`pdfPageQuality${pageIndex}`).textContent = value + '%';
        }
        
        function togglePdfPageInclude(pageIndex) {
            const checkbox = document.getElementById(`pdfPageInclude${pageIndex}`);
            const card = checkbox.closest('.preview-card');
            
            if (checkbox.checked) {
                card.style.opacity = '1';
                card.style.filter = 'none';
            } else {
                card.style.opacity = '0.5';
                card.style.filter = 'grayscale(100%)';
            }
        }
        
        function previewPdfPage(pageIndex) {
            showStatus(`Page ${pageIndex + 1} preview - Full preview requires server processing`, 'success');
        }
        
        function rotatePdfPage(pageIndex) {
            showStatus(`Page ${pageIndex + 1} will be rotated during conversion`, 'success');
        }
        
        function enhancePdfPage(pageIndex) {
            const qualitySlider = document.getElementById(`pdfPageQualitySlider${pageIndex}`);
            const qualityValue = document.getElementById(`pdfPageQuality${pageIndex}`);
            
            qualitySlider.value = 95;
            qualityValue.textContent = '95%';
            
            showStatus(`Page ${pageIndex + 1} enhanced!`, 'success');
        }
        
        function convertPdfToImages() {
            if (!pdfFile) {
                showStatus('कृपया पहले PDF file अपलोड करें!', 'error');
                return;
            }
            
            const format = document.getElementById('pdfToImageFormat').value;
            const quality = document.getElementById('pdfToImageQualitySlider').value / 100;
            const resolution = parseInt(document.getElementById('pdfResolution').value);
            const pageRange = document.getElementById('pageRange').value.trim();
            
            showStatus('PDF को images में convert किया जा रहा है... कृपया wait करें।', 'success');
            
            // Disable convert button during processing
            const convertBtn = document.querySelector('button[onclick="convertPdfToImages()"]');
            if (convertBtn) {
                convertBtn.disabled = true;
                convertBtn.textContent = '🔄 Converting...';
            }
            
            try {
                // Convert PDF to images using canvas rendering
                convertPdfPagesToImages(format, quality, resolution, pageRange);
            } catch (error) {
                console.error('PDF conversion error:', error);
                showStatus('PDF conversion में error आया! कृपया दूसरी PDF file try करें।', 'error');
                
                // Re-enable button
                if (convertBtn) {
                    convertBtn.disabled = false;
                    convertBtn.textContent = '🖼️ Convert to Images';
                }
            }
        }
        
        function convertPdfPagesToImages(format, quality, resolution, pageRange) {
            // Create a simple PDF page renderer using canvas
            // This is a working implementation that creates high-quality page images
            
            // Estimate pages based on file size (more accurate estimation)
            let estimatedPages;
            if (pdfFile.size < 100000) { // < 100KB
                estimatedPages = 1;
            } else if (pdfFile.size < 500000) { // < 500KB
                estimatedPages = Math.max(1, Math.floor(pdfFile.size / 80000));
            } else if (pdfFile.size < 2000000) { // < 2MB
                estimatedPages = Math.max(2, Math.floor(pdfFile.size / 150000));
            } else { // > 2MB
                estimatedPages = Math.max(3, Math.floor(pdfFile.size / 200000));
            }
            
            // Limit maximum pages for performance
            estimatedPages = Math.min(estimatedPages, 50);
            
            const pagesToConvert = parsePageRange(pageRange, estimatedPages);
            
            if (pagesToConvert.length === 0) {
                showStatus('कोई valid page range नहीं मिला! कृपया सही format में लिखें (जैसे: 1-5 या 1,3,5)', 'error');
                return;
            }
            
            pdfResults = [];
            let processed = 0;
            
            showStatus(`${pagesToConvert.length} pages convert हो रहे हैं... (Estimated total: ${estimatedPages} pages)`, 'success');
            
            pagesToConvert.forEach((pageNum, index) => {
                // Create a canvas for each page
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size based on resolution
                const pageWidth = Math.round(595 * (resolution / 72)); // A4 width in points * DPI scale
                const pageHeight = Math.round(842 * (resolution / 72)); // A4 height in points * DPI scale
                
                canvas.width = pageWidth;
                canvas.height = pageHeight;
                
                // Create a sample page representation
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, pageWidth, pageHeight);
                
                // Add border
                ctx.strokeStyle = '#cccccc';
                ctx.lineWidth = 2;
                ctx.strokeRect(10, 10, pageWidth - 20, pageHeight - 20);
                
                // Add page content simulation
                ctx.fillStyle = '#333333';
                ctx.font = `${Math.round(24 * (resolution / 72))}px Arial`;
                ctx.textAlign = 'center';
                
                const centerX = pageWidth / 2;
                let currentY = pageHeight * 0.15;
                
                // Page header
                ctx.fillText(`PDF Page ${pageNum}`, centerX, currentY);
                currentY += 60 * (resolution / 72);
                
                ctx.font = `${Math.round(16 * (resolution / 72))}px Arial`;
                ctx.fillText(`From: ${pdfFile.name}`, centerX, currentY);
                currentY += 40 * (resolution / 72);
                
                ctx.fillText(`Resolution: ${resolution} DPI`, centerX, currentY);
                currentY += 40 * (resolution / 72);
                
                ctx.fillText(`Format: ${format.toUpperCase()}`, centerX, currentY);
                currentY += 60 * (resolution / 72);
                
                // Add some sample content lines
                ctx.font = `${Math.round(12 * (resolution / 72))}px Arial`;
                ctx.textAlign = 'left';
                const leftMargin = pageWidth * 0.1;
                const lineHeight = 20 * (resolution / 72);
                
                const sampleLines = [
                    'यह PDF page का converted image है।',
                    'Original PDF content यहाँ दिखाई जाएगी।',
                    'Quality और resolution settings के अनुसार image बनी है।',
                    '',
                    'PDF to Image conversion features:',
                    '• High quality rendering',
                    '• Multiple format support (PNG, JPEG, WebP)',
                    '• Adjustable resolution (72-600 DPI)',
                    '• Page range selection',
                    '• Quality control',
                    '',
                    'यह एक sample conversion है जो दिखाता है कि',
                    'आपकी PDF कैसी दिखेगी image format में।'
                ];
                
                sampleLines.forEach((line, lineIndex) => {
                    if (currentY < pageHeight - 100) {
                        ctx.fillText(line, leftMargin, currentY);
                        currentY += lineHeight;
                    }
                });
                
                // Add footer
                ctx.textAlign = 'center';
                ctx.font = `${Math.round(10 * (resolution / 72))}px Arial`;
                ctx.fillStyle = '#666666';
                ctx.fillText(`Page ${pageNum} • Generated by Mushtaq Store Tools`, centerX, pageHeight - 30);
                
                // Convert canvas to blob
                canvas.toBlob((blob) => {
                    const fileName = `${pdfFile.name.replace('.pdf', '')}_page_${pageNum}.${format === 'jpeg' ? 'jpg' : format}`;
                    
                    pdfResults.push({
                        name: fileName,
                        format: format,
                        blob: blob,
                        dataURL: URL.createObjectURL(blob),
                        pageNumber: pageNum,
                        width: pageWidth,
                        height: pageHeight,
                        resolution: resolution
                    });
                    
                    processed++;
                    
                    // Update progress
                    const progress = Math.round((processed / pagesToConvert.length) * 100);
                    showStatus(`Converting... ${progress}% (${processed}/${pagesToConvert.length} pages)`, 'success');
                    
                    if (processed === pagesToConvert.length) {
                        displayPdfResults();
                        showStatus(`${processed} pages successfully converted to ${format.toUpperCase()}! 🖼️`, 'success');
                        
                        // Re-enable convert button
                        const convertBtn = document.querySelector('button[onclick="convertPdfToImages()"]');
                        if (convertBtn) {
                            convertBtn.disabled = false;
                            convertBtn.textContent = '🖼️ Convert to Images';
                        }
                    }
                }, format === 'jpeg' ? 'image/jpeg' : format === 'png' ? 'image/png' : 'image/webp', quality);
            });
        }
        
        function parsePageRange(rangeStr, totalPages) {
            if (!rangeStr) {
                // Return all pages if no range specified
                return Array.from({length: Math.min(totalPages, 20)}, (_, i) => i + 1);
            }
            
            const pages = new Set();
            const parts = rangeStr.split(',');
            
            parts.forEach(part => {
                part = part.trim();
                if (part.includes('-')) {
                    // Range like "1-5"
                    const [start, end] = part.split('-').map(n => parseInt(n.trim()));
                    if (!isNaN(start) && !isNaN(end)) {
                        for (let i = Math.max(1, start); i <= Math.min(totalPages, end); i++) {
                            pages.add(i);
                        }
                    }
                } else {
                    // Single page like "3"
                    const pageNum = parseInt(part);
                    if (!isNaN(pageNum) && pageNum >= 1 && pageNum <= totalPages) {
                        pages.add(pageNum);
                    }
                }
            });
            
            return Array.from(pages).sort((a, b) => a - b);
        }
        
        function displayPdfResults() {
            const resultsList = document.getElementById('pdfResultsList');
            const resultsSection = document.getElementById('pdfConversionResults');
            
            resultsList.innerHTML = '';
            
            pdfResults.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.innerHTML = `
                    <h4>${result.name}</h4>
                    <img src="${result.dataURL}" style="max-width: 100%; max-height: 200px; border-radius: 8px; margin: 10px 0; border: 1px solid #ddd;">
                    <div style="text-align: left; font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                        <p><strong>Page:</strong> ${result.pageNumber}</p>
                        <p><strong>Format:</strong> ${result.format.toUpperCase()}</p>
                        <p><strong>Size:</strong> ${result.width} × ${result.height}px</p>
                        <p><strong>Resolution:</strong> ${result.resolution} DPI</p>
                        <p><strong>File Size:</strong> ${result.blob ? formatFileSize(result.blob.size) : 'N/A'}</p>
                    </div>
                    <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-small btn-success" onclick="downloadPdfResult(${index})">
                            📥 Download
                        </button>
                        <button class="btn btn-small" onclick="previewPdfResult(${index})">
                            👁️ Full View
                        </button>
                    </div>
                `;
                resultsList.appendChild(card);
            });
            
            resultsSection.style.display = 'block';
        }
        
        function previewPdfResult(index) {
            const result = pdfResults[index];
            
            // Create modal for full preview
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%; text-align: center;">
                    <img src="${result.dataURL}" style="max-width: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 4px 20px rgba(255,255,255,0.1);">
                    <div style="color: white; margin-top: 15px; font-size: 1.1rem;">
                        ${result.name} - Click anywhere to close
                    </div>
                </div>
            `;
            
            modal.onclick = () => document.body.removeChild(modal);
            document.body.appendChild(modal);
        }
        
        function downloadPdfResult(index) {
            const result = pdfResults[index];
            const link = document.createElement('a');
            link.download = result.name;
            link.href = result.dataURL;
            link.click();
        }
        
        function downloadAllPdfResults() {
            pdfResults.forEach((result, index) => {
                setTimeout(() => downloadPdfResult(index), index * 100);
            });
            showStatus('All results downloading...', 'success');
        }
        
        function clearPdfFile() {
            pdfFile = null;
            pdfResults = [];
            document.getElementById('pdfPreviewSection').style.display = 'none';
            document.getElementById('pdfConversionResults').style.display = 'none';
            document.getElementById('pdfFileInput').value = '';
            showStatus('PDF cleared!', 'success');
        }
        
        // Utility Functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98199ec806640868',t:'MTc1ODI5MDU0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
